<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<title>golang中  boltdb的学习和实践  - Go语言中文网 - Golang中文社区</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
	<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
	<meta charset="utf-8">
	<link rel="shortcut icon" href="https://static.studygolang.com/img/favicon.ico">
	<link rel="apple-touch-icon" type="image/png" href="https://static.studygolang.com/static/img/logo2.png">
	<meta name="keywords" content="Go,Golang,Go语言">
<meta name="description" content="golang boltdb的学习和实践1. 安装go get github.com/boltdb/bolt2.创建和启动数据库db, err := bolt.Open(&#34;my.db&#34;, 0600, nil)其中open的第一个参数为路径,如果数据库不存在则会创建名为my.db的数据库， 第二个为文件操作，第三个参数是可选参数， 内部可以配置只读和超时时间等，特别需要注意的地方就是因为boltdb是">
	<meta name="author" content="polaris <polaris@studygolang.com>">
	<link rel="canonical" href="https://studygolang.com/" />

	
	<link rel="stylesheet" href="https://static.studygolang.com/cssjs/fonts_googleapi.css">
	<link rel="stylesheet" href="https://static.studygolang.com/cssjs/cosmo_bootstrap.min.css">
	<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://static.studygolang.com/static/dist/css/sg_libs.min.css"/>
	<link rel="stylesheet" href="https://static.studygolang.com/static/dist/css/sg_styles.min.css?v=0.3"/>
	
	

<style>
pre .line { margin: auto; line-height: 20px; border-bottom: none; }
.image-package .image-container-fill { padding-bottom: 0 !important; }
</style>



<link href="https://cdn.staticfile.org/prism/9000.0.1/themes/prism-okaidia.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/prism/9000.0.1/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">




	
	<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
	<script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
	
</head>
<body>
	<header class="navbar navbar-default navbar-fixed-top" role="navigation" style="position:relative;">
		<div class="container">
			
			<div class="navbar-header">
				<a href="/" class="navbar-brand" title="Go语言中文网"><img alt="Go语言中文网" src="https://static.studygolang.com/img/logo1.png" style="margin-top: -7px; height: 45px;"></a>
				<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
			</div>
			<div class="navbar-collapse collapse" id="navbar-main">
				<ul class="nav navbar-nav">
					<li class="">
						<a href="/topics">主题</a>
					</li>
					<li class="active">
						<a href="/articles">文章</a>
					</li>
					<li class="">
						<a href="/projects">项目</a>
					</li>
					<li class="">
						<a href="/resources">资源</a>
					</li>
					<li class="">
						<a href="/books">图书</a>
					</li>
					<li class="dropdown ">
						
						<a class="dropdown-toggle" data-toggle="dropdown" href="#" id="readings">晨读 <span class="caret"></span></a>
						<ul class="dropdown-menu" aria-labelledby="readings">
							<li><a href="/readings">Go晨读</a></li>
							<li><a href="/readings?rtype=1">综合晨读</a></li>
						</ul>
						
					</li>
					<li class="">
						<a href="/dl">下载<i class="newfuture"></i></a>
					</li>
					<li class="dropdown ">
						<a class="dropdown-toggle" data-toggle="dropdown" href="#" id="docs">官方文档 <span class="caret"></span></a>
						<ul class="dropdown-menu" aria-labelledby="docs">
						
							<li><a href="http://docs.studygolang.com" target="_blank">英文文档</a></li>
							<li><a href="http://docscn.studygolang.com" target="_blank">中文文档</a></li>
							<li><a href="/pkgdoc">标准库中文版</a></li>
							<li role="presentation" class="divider"></li>
							<li><a href="http://tour.studygolang.com" target="_blank">Go指南</a></li>
						
						</ul>
					</li>
				</ul>
				<form class="navbar-form navbar-left" action="/search" role="search" target="_blank">
					<input type="text" name="q" class="form-control search-query" placeholder="搜索" value="">
				</form>
				<ul class="nav navbar-nav navbar-right" id="userbar">
					
					<li class="first"><a href="/account/register">注册</a></li><li class="last"><a href="/account/login">登录</a></li>
					
				</ul>
			</div>
		</div>
	</header>
	<div class="wrapper" id="wrapper">
		<div class="container" role="main">
		

			
<div class="row">
	<div class="col-md-9 col-sm-6">
		<div class="sep20"></div>
		<ol class="breadcrumb">
			<li><a href="/">首页</a></li>
			<li><a href="/articles">文章</a></li>
		</ol>
		<div class="page">
			<div class="box_white">
				<div class="title">
					
					<h1 id="title" data-id="15792">
						golang中  boltdb的学习和实践
					</h1>
					<small class="c9">
					
						
						<span>ck_god</span>
						
					
						 · <span title="2018-10-25 18:35:41" class="timeago"></span> · 30 次点击 · 
						<span class="read-time"></span> · 
						<span class="timeago" title="2018-10-25 19:54:05"></span> 开始浏览 &nbsp; &nbsp;
					
					</small>
				</div>
				
				<div class="cell">
					
					<div id="myeditor" class="content article-entry">
						<h1 style="box-sizing: border-box; font-size: 39px; margin: 21px 0px 10.5px; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; white-space: normal; background-color: rgb(255, 255, 255);">golang boltdb的学习和实践</h1><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">1. 安装</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">go get github.com/boltdb/bolt</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">2.创建和启动数据库</h2><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db, err := bolt.Open(&#34;my.db&#34;, 0600, nil)</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">其中<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">open</code>的第一个参数为路径,如果数据库不存在则会创建名为my.db的数据库， 第二个为文件操作，第三个参数是可选参数， 内部可以配置只读和超时时间等，<br/>特别需要注意的地方就是因为boltdb是文件操作类型的数据库，所以只能单点写入和读取，如果多个同时操作的话后者会被挂起直到前者关闭操作为止， boltdb一次只允许一个读写事务，但一次允许多个只读事务。所以数据具有较强的一致性。</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">因此单个事务和从它们创建的所有对象（例如桶、键）都不是线程安全的。与数据在多个概念你必须为每一个或使用锁机制来保证只有一个goroutine里操作改变数据。<br/>只读事务和读写事物通常不应该在同一个goroutine里同时打开。由于读写事务需要周期性地重新映射数据文件，这可能导致死锁。</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">3.读写事务</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">boltdb的读写事务操作我们可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">DB.Update()</code>来完成形如：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">err := db.Update(func(tx *bolt.Tx) error {
    ...
    return nil
})</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">在闭包fun中,在结束时返回nil来提交事务。您还可以通过返回一个错误在任何点回滚事务。所有数据库操作都允许在读写事务中进行。<br/>始终要关注err返回，因为它将报告导致您的事务不能完成的所有磁盘故障。</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">4.批量读写事物</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">每一次新的事物都需要等待上一次事物的结束，这种开销我们可以通过<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">DB.Batch()</code>批处理来完成</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">err := db.Batch(func(tx *bolt.Tx) error {
    ...
    return nil
})</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">在批处理过程中如果某个事务失败了,批处理会多次调用这个函数函数返回成功则成功。如果中途失败了，则整个事务会回滚。</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">5.只读事务</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">只读事务可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">DB.View()</code>来完成</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">err := db.View(func(tx *bolt.Tx) error {
    ...
    return nil
})</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">不改变数据的操作都可以通过只读事务来完成， 您只能检索桶、检索值，或在只读事务中复制数据库。</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">6.启动事务</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">DB.Begin()</code>启动函数包含在db.update和db.batch中,该函数启动事务开始执行事务并返回结果关闭事务，这是boltdb推荐的方式，有时候你可能需要手动启动事物你可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">Tx.Begin()</code>来开始，切记不要忘记关闭事务。</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">// Start a writable transaction.
tx, err := db.Begin(true)
if err != nil {
    return err
}
defer tx.Rollback()

// Use the transaction...
_, err := tx.CreateBucket([]byte(&#34;MyBucket&#34;))
if err != nil {
    return err
}

// Commit the transaction and check for error.
if err := tx.Commit(); err != nil {
    return err
}</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">7.使用桶</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">桶是数据库中键/值对的集合。桶中的所有键必须是唯一的。您可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">DB.CreateBucket()</code>创建一个桶：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db.Update(func(tx *bolt.Tx) error {
    b, err := tx.CreateBucket([]byte(&#34;MyBucket&#34;))
    if err != nil {
        return fmt.Errorf(&#34;create bucket: %s&#34;, err)
    }
    return nil
})</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">你也可以是实用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">Tx.CreateBucketIfNotExists()</code>来创建桶，该函数会先判断是否已经存在该桶不存在即创建， 删除桶可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">Tx.DeleteBucket()</code>来完成</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">8.使用k-v对</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">存储键值对到桶里可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">Bucket.Put()</code>来完成：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db.Update(func(tx *bolt.Tx) error {
    b := tx.Bucket([]byte(&#34;MyFriendsBucket&#34;))
    err := b.Put([]byte(&#34;one&#34;), []byte(&#34;zhangsan&#34;))
    return err
})</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">获取键值<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">Bucket.Get()</code>：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db.View(func(tx *bolt.Tx) error {
    b := tx.Bucket([]byte(&#34;MyFriendsBucket&#34;))
    v := b.Get([]byte(&#34;one&#34;))
    fmt.Printf(&#34;The answer is: %s\n&#34;, v)
    return nil
})</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">get()</code>函数不返回一个错误，因为它的运行是保证工作（除非有某种系统故障）。如果键存在，那么它将返回它的值。如果它不存在，那么它将返回nil。<br/>还需要注意的是当事务打开都get返回的值时唯一有效的，如果你需要将该值用于其他事务，你可以通过<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">copy</code>拷贝到其他的byte slice中</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">9.桶的自增</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">利用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">nextsequence()</code>功能，你可以让boltdb生成序列作为你键值对的唯一标识。见下面的示例。</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">func (s *Store) CreateUser(u *User) error {
    return s.db.Update(func(tx *bolt.Tx) error {
        // 创建users桶
        b := tx.Bucket([]byte(&#34;users&#34;))

        // 生成自增序列
        id, _ = b.NextSequence()
        u.ID = int(id)

        // Marshal user data into bytes.
        buf, err := json.Marshal(u)
        if err != nil {
            return err
        }

        // Persist bytes to users bucket.
        return b.Put(itob(u.ID), buf)
    })
}

// itob returns an 8-byte big endian representation of v.
func itob(v int) []byte {
    b := make([]byte, 8)
    binary.BigEndian.PutUint64(b, uint64(v))
    return b
}

type User struct {
    ID int
    ...
}</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">10. 迭代键</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">boltdb以桶中的字节排序顺序存储键。这使得在这些键上的顺序迭代非常快。要遍历键，我们将使用游标<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">Cursor()</code>：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db.View(func(tx *bolt.Tx) error {
    // Assume bucket exists and has keys
    b := tx.Bucket([]byte(&#34;MyBucket&#34;))

    c := b.Cursor()

    for k, v := c.First(); k != nil; k, v = c.Next() {
        fmt.Printf(&#34;key=%s, value=%s\n&#34;, k, v)
    }

    return nil
})</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">游标<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">Cursor()</code>允许您移动到键列表中的特定点，并一次一个地通过操作键前进或后退。<br/>光标上有以下函数：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">First()  移动到第一个健.
Last()   移动到最后一个健.
Seek()   移动到特定的一个健.
Next()   移动到下一个健.
Prev()   移动到上一个健.</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">这些函数中的每一个都返回一个包含(key []byte, value []byte)的签名。当你有光标迭代结束，next()将返回一个nil。在调用next()或prev()之前，你必须寻求一个位置使用first()，last()，或seek()。如果您不寻求位置，则这些函数将返回一个nil键。<br/>在迭代过程中，如果键为非零，但值为0，则意味着键指向一个桶而不是一个值。用桶.bucket()访问子桶。</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">11.前缀扫描</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">遍历一个key的前缀，你可以结合<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">seek()</code>和<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">bytes.hasprefix()</code>：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db.View(func(tx *bolt.Tx) error {
    // Assume bucket exists and has keys
    c := tx.Bucket([]byte(&#34;MyBucket&#34;)).Cursor()

    prefix := []byte(&#34;1234&#34;)
    for k, v := c.Seek(prefix); bytes.HasPrefix(k, prefix); k, v = c.Next() {
        fmt.Printf(&#34;key=%s, value=%s\n&#34;, k, v)
    }

    return nil
})</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">12.范围扫描</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">另一个常见的用例是扫描范围，例如时间范围。如果你使用一个合适的时间编码，如rfc3339然后可以查询特定日期范围的数据：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db.View(func(tx *bolt.Tx) error {
    // Assume our events bucket exists and has RFC3339 encoded time keys.
    c := tx.Bucket([]byte(&#34;Events&#34;)).Cursor()

    // Our time range spans the 90&#39;s decade.
    min := []byte(&#34;1990-01-01T00:00:00Z&#34;)
    max := []byte(&#34;2000-01-01T00:00:00Z&#34;)

    // Iterate over the 90&#39;s.
    for k, v := c.Seek(min); k != nil &amp;&amp; bytes.Compare(k, max) &lt;= 0; k, v = c.Next() {
        fmt.Printf(&#34;%s: %s\n&#34;, k, v)
    }

    return nil
})</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">13.循环遍历每一个</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">如果你知道所在桶中拥有键，你也可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">ForEach()</code>来迭代：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db.View(func(tx *bolt.Tx) error {
    // Assume bucket exists and has keys
    b := tx.Bucket([]byte(&#34;MyBucket&#34;))

    b.ForEach(func(k, v []byte) error {
        fmt.Printf(&#34;key=%s, value=%s\n&#34;, k, v)
        return nil
    })
    return nil
})</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">14.嵌套桶</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">还可以在一个键中存储一个桶，以创建嵌套的桶：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">func (*Bucket) CreateBucket(key []byte) (*Bucket, error)
func (*Bucket) CreateBucketIfNotExists(key []byte) (*Bucket, error)
func (*Bucket) DeleteBucket(key []byte) error</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">15.数据库备份</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">boltdb是一个单一的文件，所以很容易备份。你可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">TX.writeto()</code>函数写一致的数据库。如果从只读事务调用这个函数，它将执行热备份，而不会阻塞其他数据库的读写操作。<br/>默认情况下，它将使用一个常规文件句柄，该句柄将利用操作系统的页面缓存。有关优化大于RAM数据集的信息，请参见<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">Tx</code>文档。<br/>一个常见的用例是在HTTP上进行备份，这样您就可以使用像<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">cURL</code>这样的工具来进行数据库备份：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">func BackupHandleFunc(w http.ResponseWriter, req *http.Request) {
    err := db.View(func(tx *bolt.Tx) error {
        w.Header().Set(&#34;Content-Type&#34;, &#34;application/octet-stream&#34;)
        w.Header().Set(&#34;Content-Disposition&#34;, `attachment; filename=&#34;my.db&#34;`)
        w.Header().Set(&#34;Content-Length&#34;, strconv.Itoa(int(tx.Size())))
        _, err := tx.WriteTo(w)
        return err
    })
    if err != nil {
        http.Error(w, err.Error(), http.StatusInternalServerError)
    }
}</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">然后您可以使用此命令进行备份：<br/><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">$ curl http://localhost/backup &gt; my.db</code><br/>或者你可以打开你的浏览器以<a href="http://localhost/backup" style="box-sizing: border-box; background: transparent; color: rgb(102, 102, 102); text-decoration-line: none; word-break: break-all; font-weight: 700;">http://localhost/backup</a>，它会自动下载。<br/>如果你想备份到另一个文件，你可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">TX.copyfile()</code>辅助功能。</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">16.统计</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">数据库对运行的许多内部操作保持一个运行计数，这样您就可以更好地了解发生了什么。通过捕捉这些数据的快照，我们可以看到在这个时间范围内执行了哪些操作。<br/>例如，我们可以开始一个goroutine里记录统计每10秒：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">go func() {
    // Grab the initial stats.
    prev := db.Stats()

    for {
        // Wait for 10s.
        time.Sleep(10 * time.Second)

        // Grab the current stats and diff them.
        stats := db.Stats()
        diff := stats.Sub(&amp;prev)

        // Encode stats to JSON and print to STDERR.
        json.NewEncoder(os.Stderr).Encode(diff)

        // Save stats for the next loop.
        prev = stats
    }</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">17.只读模式</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">有时创建一个共享的只读boltdb数据库是有用的。对此，设置options.readonly国旗打开数据库时。只读模式使用共享锁允许多个进程从数据库中读取，但它将阻塞任何以读写方式打开数据库的进程。</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db, err := bolt.Open(&#34;my.db&#34;, 0666, &amp;bolt.Options{ReadOnly: true})
if err != nil {
    log.Fatal(err)
}</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">18.移动端支持（ios/android）</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">boltdb能够运行在移动设备上利用的工具结合特征GoMobile。创建一个结构体，包含您的数据库逻辑和参考一个bolt.db与初始化contstructor需要在文件路径，数据库文件将存储。使用这种方法，Android和iOS都不需要额外的权限或清理。</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">func NewBoltDB(filepath string) *BoltDB {
    db, err := bolt.Open(filepath+&#34;/demo.db&#34;, 0600, nil)
    if err != nil {
        log.Fatal(err)
    }

    return &amp;BoltDB{db}
}

type BoltDB struct {
    db *bolt.DB
    ...
}

func (b *BoltDB) Path() string {
    return b.db.Path()
}

func (b *BoltDB) Close() {
    b.db.Close()
}</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">数据库逻辑应定义为此包装器结构中的方法。<br/>要从本机语言初始化此结构（两个平台现在都将本地存储与云同步）。这些片段禁用数据库文件的功能）：<br/>Android</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">String path;
if (android.os.Build.VERSION.SDK_INT &gt;=android.os.Build.VERSION_CODES.LOLLIPOP){
    path = getNoBackupFilesDir().getAbsolutePath();
} else{
    path = getFilesDir().getAbsolutePath();
}
Boltmobiledemo.BoltDB boltDB = Boltmobiledemo.NewBoltDB(path)</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">IOS</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">- (void)demo {
    NSString* path = [NSSearchPathForDirectoriesInDomains(NSLibraryDirectory,
                                                          NSUserDomainMask,
                                                          YES) objectAtIndex:0];
    GoBoltmobiledemoBoltDB * demo = GoBoltmobiledemoNewBoltDB(path);
    [self addSkipBackupAttributeToItemAtPath:demo.path];
    //Some DB Logic would go here
    [demo close];
}

- (BOOL)addSkipBackupAttributeToItemAtPath:(NSString *) filePathString
{
    NSURL* URL= [NSURL fileURLWithPath: filePathString];
    assert([[NSFileManager defaultManager] fileExistsAtPath: [URL path]]);

    NSError *error = nil;
    BOOL success = [URL setResourceValue: [NSNumber numberWithBool: YES]
                                  forKey: NSURLIsExcludedFromBackupKey error: &amp;error];
    if(!success){
        NSLog(@&#34;Error excluding %@ from backup %@&#34;, [URL lastPathComponent], error);
    }
    return success;
}</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">19.查看工具</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">1.下载工具<br/><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">go get github.com/boltdb/boltd</code><br/>然后编译cmd下的main文件生成可执行文件改名为boltd<br/>拷贝boltd到 *.db同级目录，执行如下：<br/><span class="img-wrap" style="box-sizing: border-box;"><img class="img-responsive"/></span><br/>然后打开网站：<br/><span class="img-wrap" style="box-sizing: border-box;"><img class="img-responsive"/></span></p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">2.命令行工具<br/><a href="https://github.com/hasit/bolter" style="box-sizing: border-box; background: transparent; color: rgb(102, 102, 102); text-decoration-line: none; word-break: break-all; font-weight: 700;">https://github.com/hasit/bolter</a></p><p><br/></p>
					</div>
					

					
					<div class="row orig-info">
						<p>本文来自：<a href="/wr?u=http://blog.51cto.com" target="_blank" title="51CTO博客">51CTO博客</a></p>
						<p>感谢作者：ck_god</p>
						<p>查看原文：<a href="/wr?u=http%3a%2f%2fblog.51cto.com%2f13914991%2f2308723" target="_blank" title="golang中  boltdb的学习和实践">golang中  boltdb的学习和实践</a></p>
					</div>
					
				</div>
				
				<div class="content-buttons">
					<div class="pull-right c9 f11" style="line-height: 12px; padding-top: 3px; text-shadow: 0px 1px 0px #fff;">30 次点击 &nbsp;</div>
					<a class="tb collect" href="javascript:;" title="加入收藏" data-objid="15792" data-objtype="1" data-collect="">加入收藏</a> 
					<a href="javascript:" onclick="window.open('http://service.weibo.com/share/share.php?url=https://studygolang.com/articles/15792&title='+encodeURIComponent('Go语言中文网 - golang中  boltdb的学习和实践 by ck_god #golang#'), '_blank', 'width=550,height=370');" class="tb">微博</a>
					<div id="content-thank">
						<a class="tb" href="javascript:;" title="赞" data-objid="15792" data-objtype="1" data-flag="">赞</a>
					</div>
				</div>
			</div>
			

			<div class="sep20"></div>
			<div class="box_white">
				<div class="cell subject">
					
					<div class="item-list">
					
						<a class="add-collection" href="javascript:"><i class="fa fa-plus"></i> 收入我的专栏</a>
					</div>
				</div>
			</div>

			<div class="sep20"></div>
			<div class="box_white">
				<div class="cell row">
					
					<div class="col-sm-6">上一篇：<a href="/articles/15791">区块链入门教程以太坊源码分析p2p-dial.go源码分析</a></div>
					
					
				</div>
			</div>

			<div class="sep20"></div>

			
			<div id="replies" class="box_white">
				<div class="cell">
					<div class="pull-right" style="margin: -3px -5px 0px 0px;">
					
						
						
						<a href="/tag/%e5%87%bd%e6%95%b0" class="tag"><li class="fa fa-tag"></li> 函数</a>
						
						<a href="/tag/android" class="tag"><li class="fa fa-tag"></li> android</a>
						
						<a href="/tag/goroutine" class="tag"><li class="fa fa-tag"></li> goroutine</a>
						
						<a href="/tag/%e9%94%ae%e5%80%bc" class="tag"><li class="fa fa-tag"></li> 键值</a>
						
					
					</div>
					<span class="c9"><span class="cmtnum">0</span> 回复 </span>
				</div>
				<div class="comment-list cell" data-objid="15792" data-objtype="1" >
					<div class="words hide"><div class="text-center">暂无回复</div></div>
				</div>
			</div>

			
			
<div class="sep10"></div>
<div class="box_white page-comment">
	<input type="hidden" name="me-uid" value="0"/>
	<div class="cell">添加一条新回复
	
	<span class="h2-tip">
	（您需要 <a class="c-log" href="javascript:openPop('#login-pop');">登录</a> 后才能回复 <a href="/user/register" class="c-reg"> 没有账号</a> ？）</span>
	
	</div>
	<div class="cell">
		<div class="row clearfix md-toolbar">
			<ul class="col-md-10 list-inline comment-tab-menu" data-comment-group="default">
				<li class="comment-edit-tab cur"><a href="#" class="op">编辑</a></li>
				<li class="comment-preview-tab"><a href="#" class="op">预览</a></li>
				<li>
					<div class="nav reply-to dn" data-floor="" data-username="">
						<i class="fa fa-mail-reply" title=""></i>
						<a href="#reply" class="user" title=""></a>
						<a href="#" class="close"><i class="fa fa-close"></i></a>
					</div>
				</li>
			</ul>
			<div class="col-md-2 text-right">
				<i id="upload-img" class="glyphicon glyphicon-picture upload-img tool-tip" data-toggle="tooltip" data-placement="top" title="上传图片"></i>
			</div>
		</div>
		<div class="submit" id="commentForm">
			<div class="comment-content-text" data-comment-group="default">
				<textarea id="comment-content" name="content" class="comment-textarea main-textarea need-autogrow" rows="8"></textarea>
			</div>
			<div class="comment-content-preview cell" data-comment-group="default"></div>
			<div class="sub row">
				<ul class="help-block col-md-10">
					<li>请尽量让自己的回复能够对别人有帮助</li>
					<li class="markdown_tip">支持 Markdown 格式, <strong>**粗体**</strong>、~~删除线~~、<code>`单行代码`</code></li>
					<li>支持 @ 本站用户；支持表情（输入 : 提示），见 <a href="http://www.emoji-cheat-sheet.com/" target="_blank">Emoji cheat sheet</a></li>
					<li>图片支持拖拽、截图粘贴等方式上传</li>
				</ul>
				<div class="col-md-2 text-right"><button id="comment-submit" type="submit" title="提交" class="btn btn-default">提交</button></div>
			</div>
		</div>
	</div>
</div>

<style type="text/css">
#replies { margin-bottom: 15px; }
#replies .reply {
	margin: 0 -15px;
	padding: 15px 15px;
	position: relative;
	border-bottom: 1px solid #eee;
	padding-left: 74px;
}
#replies .reply .avatar {
	position: absolute;
	top: 15px;
	left: 15px;
}
.avatar-48 {
	width: 48px;
	height: 48px;
	border-radius: 120px;
}
.media-object {
	display: block;
}
.avatar-16 {
	width: 16px;
	height: 16px;
	border-radius: 120px;
}
#replies .reply .reply-to-block .info .media-object {
	display: inline-block;
	margin-right: 5px;
	vertical-align: top;
}
#replies .reply .reply-to-block .info {
	margin: 0;
}
#replies .reply .reply-to-block .info .user-name {
	font-weight: bold;
}
#replies .reply .reply-to-block {
	padding: 8px 15px;
	background: #f7f7f7;
	border-radius: 3px;
	margin-bottom: 10px;
}
.avatar .uface, .avatar .media-object {
	border-radius: 120px;
}
#replies .reply .infos {
	min-height: 48px;
}
#replies .reply .info {
	color: #999;
	margin-bottom: 6px;
	font-size: 12px;
}
#replies .reply .info .name {
	font-weight: bold;
	font-size: 13px;
}
#replies .reply .info .name a {
	color: #555;
}
#replies .reply .info .floor {
	color: #7AA87A;
}
#replies .reply .info a.time {
	color: #999;
	border-bottom: 1px dashed #ccc;
	text-decoration: none !important;
	cursor: pointer;
}
abbr[title] {
	border-bottom: 0px;
	cursor: pointer;
}
.opts {
	color: #666;
}
@media (min-width: 1026px) {
	#replies .reply .hideable {
		display: none;
	}
}
#replies .reply .opts a {
	display: inline-block;
	vertical-align: baseline;
	line-height: 22px;
	padding: 2px 5px;
	height: 22px;
	min-width: 22px;
	text-align: center;
}
#replies .info .opts a {
	font-size: 13px;
	margin-left: 5px;
	color: #999;
}
#replies .info .opts a.edit {
	display: none;
}
.markdown {
	position: relative;
	letter-spacing: .03em;
	font-size: 15px;
	text-overflow: ellipsis;
	word-wrap: break-word;
}
.markdown img.twemoji {
	width: 20px;
}
.markdown img {
	vertical-align: top;
	max-width: 100%;
}
.markdown p {
	font-size: 14px;
	line-height: 26px;
	margin-bottom: 0;
	color: #000;
}
.md-toolbar .reply-to {
    padding-top: 3px;
    padding-left: 8px;
}
.close {
    float: right;
    font-size: 21px;
    font-weight: 700;
    line-height: 1;
    color: #000;
    text-shadow: 0 1px 0 #fff;
    filter: alpha(opacity=20);
    opacity: .2;
}
a.close:hover {
	background-color: #d0d0d0;
    color: #666
}
.md-toolbar .reply-to .close {
    font-size: 14px;
    margin-left: 5px;
    margin-top: 1px;
}
.edit-wrapper {
	display: none;
	border: 1px solid #c0d3eb;
	padding: 8px;
	border-radius: 4px;
}

.edit-textarea {
	resize: none;
	width: 100%;
	color: #000;
	font-size: 14px;
	border: 1px solid #E5E5E5;
	padding: 5px;
}
.btn-edit {
	cursor: pointer;
}


</style>

<script type="text/x-jsrender" id="one-comment">
<div class="reply [%if is_new%]light[%/if%]" id="reply-[%:comment.floor%]">
	<div data-floor="[%:comment.floor%]">
		<div class="avatar"><a title="[%:user.username%]" href="/user/[%:user.username%]"><img class="media-object avatar-48" src="[%:user.avatar%]" alt="[%:user.username%]"></a></div>
			<div class="infos">
				<div class="info">
					<span class="name">
						<a class="user-name" data-name="[%:user.name%]" href="/user/[%:user.username%]">[%:user.username%]</a>
					</span> ·
					<span class="floor">#[%:comment.floor%]</span> ·
					<abbr class="timeago" title="[%:comment.ctime%]">[%:comment.cmt_time%]</abbr>
					<span class="opts pull-right">
						<span class="op-reply hideable">
							[%if me.uid == user.uid %]
								<a data-floor="[%:comment.floor%]" title="编辑" class="btn-edit glyphicon glyphicon-edit"></a>
							[%/if%]
						  <a data-floor="[%:comment.floor%]" data-username="[%:user.username%]" title="回复此楼" class="btn-reply fa fa-mail-reply" href="#"></a>
						</span>
						
					</span>
				</div>
				[%if comment.reply_floor > 0%]
				<div class="reply-to-block">
					<div class="info reply_user">
						对
						<a data-remote="true" href="/user/[%:comment.reply_user.username%]">
							<img class="media-object avatar-16" src="[%:comment.reply_user.avatar%]" alt="[%:comment.reply_user.username%]"><span class="user-name">[%:comment.reply_user.username%]</span>
						</a>
						<a href="#reply-[%:comment.reply_floor%]"><span class="reply-floor">#[%:comment.reply_floor%]</span></a> 回复
					</div>
					<div class="markdown dn">
						<p>[%:comment.reply_content%]</p>
					</div>
				</div>
				[%/if%]

			<div class="markdown" data-floor="[%:comment.floor%]">
				<div class="content">[%:comment.content%]</div>
				<div class="edit-wrapper">
					<div class="row clearfix md-toolbar">
						<ul class="col-md-10 list-inline comment-tab-menu" data-comment-group="[%:comment.floor%]">
								<li class="comment-edit-tab cur"><a href="#" class="op">编辑</a></li>
								<li class="comment-preview-tab"><a href="#" class="op">预览</a></li>
						</ul>
						<div class="col-md-2 text-right">
							<i data-floor="[%:comment.floor%]" class="glyphicon glyphicon-picture upload-img tool-tip" data-toggle="tooltip" data-placement="top" title="上传图片"></i>
						</div>
					</div>
					<div class="comment-content-text" data-comment-group="[%:comment.floor%]">
						<textarea data-raw-content="[%:comment.rawContent%]" name="content" class="comment-textarea" rows="8" style="width: 100%;">[%:comment.rawContent%]</textarea>
					</div>
					<div class="comment-content-preview cell" data-comment-group="[%:comment.floor%]"></div>
					<div class="text-right">
						<button type="submit" title="提交" data-cid="[%:comment.cid%]" data-floor="[%:comment.floor%]" class="submit btn btn-default">提交</button>
						<button title="取消" data-floor="[%:comment.floor%]" class="cancel btn btn-default">取消</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</script>


			

			
		</div>
	</div>
	<div class="col-md-3 col-sm-6">
		<div class="sep20"></div>
		<div class="box_white sidebar">
	
	<div class="top">
		<h3 class="title"><i class="glyphicon glyphicon-user"></i> 用户登录</h3>
	</div>
	<div class="sb-content inner_content" style="padding-bottom: 0;">
		<form action="/account/login" method="post" class="form-horizontal login" role="form" style="padding-top: 0; padding-bottom: 0;">
			<div class="form-group">
				<div class="col-sm-10">
					<input type="text" class="form-control input-sm" id="username" name="username" placeholder="请填写用户名或邮箱">
				</div>
			</div>
			<div class="form-group">
				<div class="col-sm-10">
					<input type="password" class="form-control input-sm" id="passwd" name="passwd" placeholder="请填写密码">
				</div>
			</div>
			<div class="form-group">
				<div class="col-sm-10">
					<div class="checkbox">
						<label>
							<input id="user_remember_me" name="remember_me" type="checkbox" value="1" checked="checked" />	记住登录状态
						</label>
						<input class="btn btn-default btn-sm" data-disable-with="正在登录" name="commit" type="submit" value="登录" />
					</div>
					<div class="sep10"></div>
					<a href="/oauth/github/login" class="btn btn-default btn-sm">
						<i class="fa fa-github" aria-hidden="true"></i>
						GitHub 登录
					</a>
				</div>
			</div>
		</form>
	</div>
	
</div>





		
		<div class="box_white sidebar" id="ad-right1">
			
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-4512014793067058"
     data-ad-slot="4230018468"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			
		</div>
		

		<div class="box_white sidebar">
	<div class="top">
		<h3 class="title"><i class="glyphicon glyphicon-stats"></i>&nbsp;今日阅读排行</h3>
	</div>
	<div class="sb-content">
		<div class="rank-list" data-objtype="1" data-limit="10" data-rank_type="today">
			<ul class="list-unstyled">
				<img src="/static/img/loaders/loader7.gif" alt="加载中" />
			</ul>
		</div>
	</div>
</div>
		
		
		<div class="box_white sidebar" id="ad-right2">
			
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 侧边栏自适应 -->
<ins class="adsbygoogle"
     style="display:inline-block;min-width:270px;max-width:970px;width:100%;height:290px"
     data-ad-client="ca-pub-4512014793067058"
     data-ad-slot="3487838313"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
			
		</div>
		

		<div class="box_white sidebar">
	<div class="top">
		<h3 class="title"><i class="glyphicon glyphicon-stats"></i>&nbsp;一周阅读排行</h3>
	</div>
	<div class="sb-content">
		<div class="rank-list" data-objtype="1" data-limit="10" data-rank_type="week">
			<ul class="list-unstyled">
				<img src="/static/img/loaders/loader7.gif" alt="加载中" />
			</ul>
		</div>
	</div>
</div>
		
	</div>
</div>

<link rel="stylesheet" href="https://static.studygolang.com/static/dist/css/modal.min.css?v=0.1">
<div class="modal contribute-modal animated" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close">×</button>
                <h4 class="modal-title">
                    给该专栏投稿
                    <a href="/articles/new" class="new-note-btn">写篇新文章</a>
                </h4>
                <span class="notice">每篇文章有总共有 5 次投稿机会</span>
                <div>
                    <input type="text" placeholder="搜索我的文章" class="search-input">
                    <a class="search-btn">
                        <i class="fa fa-search" aria-hidden="true" style="margin: 8px -1px 0 0;display: block;"></i>
                    </a>
                </div>
            </div>
            <div class="modal-body">
                <ul id="contribute-note-list"></ul>
                <div class="modal-notes-placeholder" style="display: none;">
                    <div class="text"></div>
                    <div class="btn"></div>
                </div>
            </div>
            <div class="modal-footer"></div>
        </div>
    </div>
</div>


<div class="modal animated add-self" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" data-dismiss="modal" class="close">×</button>
                <h4 class="modal-title">收入到我管理的专栏
                    <span class="new-collection-btn"><a href="/subject/new" target="_blank">新建专栏</a></span>
                </h4>
            </div>
            <div class="modal-body">
                <div class="search">
                    <input type="search" name="search-self" placeholder="搜索我管理的专栏">
                    <a class="search-btn">
                        <i class="fa fa-search" aria-hidden="true" style="margin: 6px 1px 0 0;display: block;"></i>
                    </a>
                </div>
                <ul id="self-note-list"></ul>
                <div class="modal-collections-placeholder" style="display: none;">
                    <div class="avatar"></div>
                    <div class="wrap">
                        <div class="btn"></div>
                        <div class="name"></div>
                        <div class="text"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer"></div>
        </div>
    </div>
</div>



<template id="content_tpl">
<h1 style="box-sizing: border-box; font-size: 39px; margin: 21px 0px 10.5px; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; white-space: normal; background-color: rgb(255, 255, 255);">golang boltdb的学习和实践</h1><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">1. 安装</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">go get github.com/boltdb/bolt</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">2.创建和启动数据库</h2><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db, err := bolt.Open(&#34;my.db&#34;, 0600, nil)</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">其中<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">open</code>的第一个参数为路径,如果数据库不存在则会创建名为my.db的数据库， 第二个为文件操作，第三个参数是可选参数， 内部可以配置只读和超时时间等，<br/>特别需要注意的地方就是因为boltdb是文件操作类型的数据库，所以只能单点写入和读取，如果多个同时操作的话后者会被挂起直到前者关闭操作为止， boltdb一次只允许一个读写事务，但一次允许多个只读事务。所以数据具有较强的一致性。</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">因此单个事务和从它们创建的所有对象（例如桶、键）都不是线程安全的。与数据在多个概念你必须为每一个或使用锁机制来保证只有一个goroutine里操作改变数据。<br/>只读事务和读写事物通常不应该在同一个goroutine里同时打开。由于读写事务需要周期性地重新映射数据文件，这可能导致死锁。</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">3.读写事务</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">boltdb的读写事务操作我们可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">DB.Update()</code>来完成形如：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">err := db.Update(func(tx *bolt.Tx) error {
    ...
    return nil
})</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">在闭包fun中,在结束时返回nil来提交事务。您还可以通过返回一个错误在任何点回滚事务。所有数据库操作都允许在读写事务中进行。<br/>始终要关注err返回，因为它将报告导致您的事务不能完成的所有磁盘故障。</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">4.批量读写事物</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">每一次新的事物都需要等待上一次事物的结束，这种开销我们可以通过<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">DB.Batch()</code>批处理来完成</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">err := db.Batch(func(tx *bolt.Tx) error {
    ...
    return nil
})</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">在批处理过程中如果某个事务失败了,批处理会多次调用这个函数函数返回成功则成功。如果中途失败了，则整个事务会回滚。</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">5.只读事务</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">只读事务可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">DB.View()</code>来完成</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">err := db.View(func(tx *bolt.Tx) error {
    ...
    return nil
})</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">不改变数据的操作都可以通过只读事务来完成， 您只能检索桶、检索值，或在只读事务中复制数据库。</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">6.启动事务</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">DB.Begin()</code>启动函数包含在db.update和db.batch中,该函数启动事务开始执行事务并返回结果关闭事务，这是boltdb推荐的方式，有时候你可能需要手动启动事物你可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">Tx.Begin()</code>来开始，切记不要忘记关闭事务。</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">// Start a writable transaction.
tx, err := db.Begin(true)
if err != nil {
    return err
}
defer tx.Rollback()

// Use the transaction...
_, err := tx.CreateBucket([]byte(&#34;MyBucket&#34;))
if err != nil {
    return err
}

// Commit the transaction and check for error.
if err := tx.Commit(); err != nil {
    return err
}</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">7.使用桶</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">桶是数据库中键/值对的集合。桶中的所有键必须是唯一的。您可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">DB.CreateBucket()</code>创建一个桶：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db.Update(func(tx *bolt.Tx) error {
    b, err := tx.CreateBucket([]byte(&#34;MyBucket&#34;))
    if err != nil {
        return fmt.Errorf(&#34;create bucket: %s&#34;, err)
    }
    return nil
})</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">你也可以是实用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">Tx.CreateBucketIfNotExists()</code>来创建桶，该函数会先判断是否已经存在该桶不存在即创建， 删除桶可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">Tx.DeleteBucket()</code>来完成</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">8.使用k-v对</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">存储键值对到桶里可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">Bucket.Put()</code>来完成：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db.Update(func(tx *bolt.Tx) error {
    b := tx.Bucket([]byte(&#34;MyFriendsBucket&#34;))
    err := b.Put([]byte(&#34;one&#34;), []byte(&#34;zhangsan&#34;))
    return err
})</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">获取键值<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">Bucket.Get()</code>：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db.View(func(tx *bolt.Tx) error {
    b := tx.Bucket([]byte(&#34;MyFriendsBucket&#34;))
    v := b.Get([]byte(&#34;one&#34;))
    fmt.Printf(&#34;The answer is: %s\n&#34;, v)
    return nil
})</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">get()</code>函数不返回一个错误，因为它的运行是保证工作（除非有某种系统故障）。如果键存在，那么它将返回它的值。如果它不存在，那么它将返回nil。<br/>还需要注意的是当事务打开都get返回的值时唯一有效的，如果你需要将该值用于其他事务，你可以通过<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">copy</code>拷贝到其他的byte slice中</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">9.桶的自增</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">利用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">nextsequence()</code>功能，你可以让boltdb生成序列作为你键值对的唯一标识。见下面的示例。</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">func (s *Store) CreateUser(u *User) error {
    return s.db.Update(func(tx *bolt.Tx) error {
        // 创建users桶
        b := tx.Bucket([]byte(&#34;users&#34;))

        // 生成自增序列
        id, _ = b.NextSequence()
        u.ID = int(id)

        // Marshal user data into bytes.
        buf, err := json.Marshal(u)
        if err != nil {
            return err
        }

        // Persist bytes to users bucket.
        return b.Put(itob(u.ID), buf)
    })
}

// itob returns an 8-byte big endian representation of v.
func itob(v int) []byte {
    b := make([]byte, 8)
    binary.BigEndian.PutUint64(b, uint64(v))
    return b
}

type User struct {
    ID int
    ...
}</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">10. 迭代键</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">boltdb以桶中的字节排序顺序存储键。这使得在这些键上的顺序迭代非常快。要遍历键，我们将使用游标<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">Cursor()</code>：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db.View(func(tx *bolt.Tx) error {
    // Assume bucket exists and has keys
    b := tx.Bucket([]byte(&#34;MyBucket&#34;))

    c := b.Cursor()

    for k, v := c.First(); k != nil; k, v = c.Next() {
        fmt.Printf(&#34;key=%s, value=%s\n&#34;, k, v)
    }

    return nil
})</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">游标<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">Cursor()</code>允许您移动到键列表中的特定点，并一次一个地通过操作键前进或后退。<br/>光标上有以下函数：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">First()  移动到第一个健.
Last()   移动到最后一个健.
Seek()   移动到特定的一个健.
Next()   移动到下一个健.
Prev()   移动到上一个健.</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">这些函数中的每一个都返回一个包含(key []byte, value []byte)的签名。当你有光标迭代结束，next()将返回一个nil。在调用next()或prev()之前，你必须寻求一个位置使用first()，last()，或seek()。如果您不寻求位置，则这些函数将返回一个nil键。<br/>在迭代过程中，如果键为非零，但值为0，则意味着键指向一个桶而不是一个值。用桶.bucket()访问子桶。</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">11.前缀扫描</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">遍历一个key的前缀，你可以结合<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">seek()</code>和<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">bytes.hasprefix()</code>：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db.View(func(tx *bolt.Tx) error {
    // Assume bucket exists and has keys
    c := tx.Bucket([]byte(&#34;MyBucket&#34;)).Cursor()

    prefix := []byte(&#34;1234&#34;)
    for k, v := c.Seek(prefix); bytes.HasPrefix(k, prefix); k, v = c.Next() {
        fmt.Printf(&#34;key=%s, value=%s\n&#34;, k, v)
    }

    return nil
})</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">12.范围扫描</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">另一个常见的用例是扫描范围，例如时间范围。如果你使用一个合适的时间编码，如rfc3339然后可以查询特定日期范围的数据：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db.View(func(tx *bolt.Tx) error {
    // Assume our events bucket exists and has RFC3339 encoded time keys.
    c := tx.Bucket([]byte(&#34;Events&#34;)).Cursor()

    // Our time range spans the 90&#39;s decade.
    min := []byte(&#34;1990-01-01T00:00:00Z&#34;)
    max := []byte(&#34;2000-01-01T00:00:00Z&#34;)

    // Iterate over the 90&#39;s.
    for k, v := c.Seek(min); k != nil &amp;&amp; bytes.Compare(k, max) &lt;= 0; k, v = c.Next() {
        fmt.Printf(&#34;%s: %s\n&#34;, k, v)
    }

    return nil
})</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">13.循环遍历每一个</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">如果你知道所在桶中拥有键，你也可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">ForEach()</code>来迭代：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db.View(func(tx *bolt.Tx) error {
    // Assume bucket exists and has keys
    b := tx.Bucket([]byte(&#34;MyBucket&#34;))

    b.ForEach(func(k, v []byte) error {
        fmt.Printf(&#34;key=%s, value=%s\n&#34;, k, v)
        return nil
    })
    return nil
})</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">14.嵌套桶</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">还可以在一个键中存储一个桶，以创建嵌套的桶：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">func (*Bucket) CreateBucket(key []byte) (*Bucket, error)
func (*Bucket) CreateBucketIfNotExists(key []byte) (*Bucket, error)
func (*Bucket) DeleteBucket(key []byte) error</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">15.数据库备份</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">boltdb是一个单一的文件，所以很容易备份。你可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">TX.writeto()</code>函数写一致的数据库。如果从只读事务调用这个函数，它将执行热备份，而不会阻塞其他数据库的读写操作。<br/>默认情况下，它将使用一个常规文件句柄，该句柄将利用操作系统的页面缓存。有关优化大于RAM数据集的信息，请参见<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">Tx</code>文档。<br/>一个常见的用例是在HTTP上进行备份，这样您就可以使用像<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">cURL</code>这样的工具来进行数据库备份：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">func BackupHandleFunc(w http.ResponseWriter, req *http.Request) {
    err := db.View(func(tx *bolt.Tx) error {
        w.Header().Set(&#34;Content-Type&#34;, &#34;application/octet-stream&#34;)
        w.Header().Set(&#34;Content-Disposition&#34;, `attachment; filename=&#34;my.db&#34;`)
        w.Header().Set(&#34;Content-Length&#34;, strconv.Itoa(int(tx.Size())))
        _, err := tx.WriteTo(w)
        return err
    })
    if err != nil {
        http.Error(w, err.Error(), http.StatusInternalServerError)
    }
}</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">然后您可以使用此命令进行备份：<br/><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">$ curl http://localhost/backup &gt; my.db</code><br/>或者你可以打开你的浏览器以<a href="http://localhost/backup" style="box-sizing: border-box; background: transparent; color: rgb(102, 102, 102); text-decoration-line: none; word-break: break-all; font-weight: 700;">http://localhost/backup</a>，它会自动下载。<br/>如果你想备份到另一个文件，你可以使用<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">TX.copyfile()</code>辅助功能。</p><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">16.统计</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">数据库对运行的许多内部操作保持一个运行计数，这样您就可以更好地了解发生了什么。通过捕捉这些数据的快照，我们可以看到在这个时间范围内执行了哪些操作。<br/>例如，我们可以开始一个goroutine里记录统计每10秒：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">go func() {
    // Grab the initial stats.
    prev := db.Stats()

    for {
        // Wait for 10s.
        time.Sleep(10 * time.Second)

        // Grab the current stats and diff them.
        stats := db.Stats()
        diff := stats.Sub(&amp;prev)

        // Encode stats to JSON and print to STDERR.
        json.NewEncoder(os.Stderr).Encode(diff)

        // Save stats for the next loop.
        prev = stats
    }</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">17.只读模式</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">有时创建一个共享的只读boltdb数据库是有用的。对此，设置options.readonly国旗打开数据库时。只读模式使用共享锁允许多个进程从数据库中读取，但它将阻塞任何以读写方式打开数据库的进程。</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">db, err := bolt.Open(&#34;my.db&#34;, 0666, &amp;bolt.Options{ReadOnly: true})
if err != nil {
    log.Fatal(err)
}</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">18.移动端支持（ios/android）</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">boltdb能够运行在移动设备上利用的工具结合特征GoMobile。创建一个结构体，包含您的数据库逻辑和参考一个bolt.db与初始化contstructor需要在文件路径，数据库文件将存储。使用这种方法，Android和iOS都不需要额外的权限或清理。</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">func NewBoltDB(filepath string) *BoltDB {
    db, err := bolt.Open(filepath+&#34;/demo.db&#34;, 0600, nil)
    if err != nil {
        log.Fatal(err)
    }

    return &amp;BoltDB{db}
}

type BoltDB struct {
    db *bolt.DB
    ...
}

func (b *BoltDB) Path() string {
    return b.db.Path()
}

func (b *BoltDB) Close() {
    b.db.Close()
}</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">数据库逻辑应定义为此包装器结构中的方法。<br/>要从本机语言初始化此结构（两个平台现在都将本地存储与云同步）。这些片段禁用数据库文件的功能）：<br/>Android</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">String path;
if (android.os.Build.VERSION.SDK_INT &gt;=android.os.Build.VERSION_CODES.LOLLIPOP){
    path = getNoBackupFilesDir().getAbsolutePath();
} else{
    path = getFilesDir().getAbsolutePath();
}
Boltmobiledemo.BoltDB boltDB = Boltmobiledemo.NewBoltDB(path)</pre><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">IOS</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 14px; padding: 10px; margin-top: 0px; margin-bottom: 10.5px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 0px;">- (void)demo {
    NSString* path = [NSSearchPathForDirectoriesInDomains(NSLibraryDirectory,
                                                          NSUserDomainMask,
                                                          YES) objectAtIndex:0];
    GoBoltmobiledemoBoltDB * demo = GoBoltmobiledemoNewBoltDB(path);
    [self addSkipBackupAttributeToItemAtPath:demo.path];
    //Some DB Logic would go here
    [demo close];
}

- (BOOL)addSkipBackupAttributeToItemAtPath:(NSString *) filePathString
{
    NSURL* URL= [NSURL fileURLWithPath: filePathString];
    assert([[NSFileManager defaultManager] fileExistsAtPath: [URL path]]);

    NSError *error = nil;
    BOOL success = [URL setResourceValue: [NSNumber numberWithBool: YES]
                                  forKey: NSURLIsExcludedFromBackupKey error: &amp;error];
    if(!success){
        NSLog(@&#34;Error excluding %@ from backup %@&#34;, [URL lastPathComponent], error);
    }
    return success;
}</pre><h2 style="box-sizing: border-box; font-family: &#34;Source Sans Pro&#34;, Calibri, Candara, Arial, sans-serif; font-weight: 300; line-height: 1.1; margin-top: 21px; margin-bottom: 10.5px; font-size: 32px; white-space: normal; background-color: rgb(255, 255, 255);">19.查看工具</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">1.下载工具<br/><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &#34;Courier New&#34;, monospace; font-size: 12.6px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-radius: 0px;">go get github.com/boltdb/boltd</code><br/>然后编译cmd下的main文件生成可执行文件改名为boltd<br/>拷贝boltd到 *.db同级目录，执行如下：<br/><span class="img-wrap" style="box-sizing: border-box;"><img class="img-responsive"/></span><br/>然后打开网站：<br/><span class="img-wrap" style="box-sizing: border-box;"><img class="img-responsive"/></span></p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#34;Helvetica Neue&#34;, &#34;Luxi Sans&#34;, &#34;DejaVu Sans&#34;, Tahoma, &#34;Hiragino Sans GB&#34;, &#34;Microsoft Yahei&#34;, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255);">2.命令行工具<br/><a href="https://github.com/hasit/bolter" style="box-sizing: border-box; background: transparent; color: rgb(102, 102, 102); text-decoration-line: none; word-break: break-all; font-weight: 700;">https://github.com/hasit/bolter</a></p><p><br/></p>
</template>



		</div>
	</div>
	<div class="sep10"></div>
	<footer id="bottom">
		<div class="container nav-content">
			<div class="inner_content">
				<div class="sep10"></div>   
				<strong>
					
					<a href="/wiki/about" class="dark">关于</a> &nbsp; <span class="snow">•</span> &nbsp; 
					
					<a href="/wiki/faq" class="dark">FAQ</a> &nbsp; <span class="snow">•</span> &nbsp; 
					
					<a href="/wiki/contributors" class="dark">贡献者</a> &nbsp; <span class="snow">•</span> &nbsp; 
					
					<a href="/go/feedback" class="dark">反馈</a> &nbsp; <span class="snow">•</span> &nbsp; 
					
					<a href="https://github.com/studygolang" class="dark">Github</a> &nbsp; <span class="snow">•</span> &nbsp; 
					
					<a href="http://weibo.com/studygolang" class="dark">新浪微博</a> &nbsp; <span class="snow">•</span> &nbsp; 
					
					<a href="https://play.studygolang.com" class="dark">Play</a> &nbsp; <span class="snow">•</span> &nbsp; 
					
					<a href="/wiki/duty" class="dark">免责声明</a> &nbsp; <span class="snow">•</span> &nbsp; 
					
					<a href="/wiki/contact" class="dark">联系我们</a> &nbsp; <span class="snow">•</span> &nbsp; 
					
					<a href="/wiki/donate" class="dark">捐赠</a> &nbsp; <span class="snow">•</span> &nbsp; 
					
					<a href="/wiki/cool" class="dark">酷站</a> &nbsp; <span class="snow">•</span> &nbsp; 
					
					<a href="/feed.html" class="dark">Feed订阅</a> &nbsp; <span class="snow">•</span> &nbsp; 
					
					<span id="onlineusers">1502</span> 人在线
				</strong>
				&nbsp;<span class="cc">最高记录 <span id="maxonline">2928</span></span>
				<div class="sep20"></div>
				&copy;2013-2018 studygolang.com Go语言中文网，中国 Golang 社区，致力于构建完善的 Golang 中文社区，Go语言爱好者的学习家园。
				<div class="sep5"></div>
				Powered by <a href="https://github.com/studygolang/studygolang">StudyGolang(Golang + MySQL)</a> &nbsp;<span class="snow">•</span>&nbsp;<span class="snow">·</span>&nbsp;CDN 采用 <a href="https://portal.qiniu.com/signup?code=3lfz4at7pxfma" title="七牛云" class="dark" target="_blank">七牛云</a>
				<div class="sep20"></div>
				<span class="small cc">VERSION: V3.5.0&nbsp;<span class="snow">·</span>&nbsp;8.207873ms&nbsp;<span class="snow">·</span>&nbsp;<strong>为了更好的体验，本站推荐使用 Chrome 或 Firefox 浏览器</strong></span>
				<div class="sep20"></div>
				<span class="f12 c9"><a href="http://www.miibeian.gov.cn/" target="_blank" rel="nofollow">京ICP备14030343号-1</a></span>
				<div class="sep10"></div>
			</div>
		</div>
	</footer>

	<div id="gotop"></div>

	
	<input type="hidden" id="is_login_status" value="0" />
	<div class="pop login-pop" id="login-pop">
		<div style="position: relative;"><span class="close" style="position: absolute; right: -15px; top: -15px; cursor: pointer; color: #000; font-size: 13px;">X</span></div>
		<div class="login-form">
			<div class="error text-center"></div>
			<div class="text-center" style="margin-bottom: 5px;">登录和大家一起探讨吧</div>
			<form action="#" method="post" class="form-horizontal" role="form">
				<div class="form-group">
					<label for="username" class="col-sm-3 control-label">用户名</label>
					<div class="col-sm-9 form-input">
						<input type="text" class="form-control" id="form_username" name="username" placeholder="请填写用户名或邮箱">
					</div>
				</div>
				<div class="form-group">
					<label for="passwd" class="col-sm-3 control-label">密码</label>
					<div class="col-sm-9 form-input">
						<input type="password" class="form-control" id="form_passwd" name="passwd" placeholder="密码">
					</div>
				</div>
				<div class="form-group">
					<div class="col-sm-offset-2 col-sm-10">
						<div class="checkbox">
							<label>
								<input id="user_remember_me" name="remember_me" type="checkbox" value="1" checked="checked" />	记住登录状态
							</label>
							<button type="submit" id="login-btn" class="btn btn-default btn-sm">登录</button>
						</div>
					</div>
				</div>
				<div class="form-group">
					<div class="col-sm-offset-2 col-sm-10">
						<a id="login-github" href="/oauth/github/login" class="btn btn-default btn-sm pull-left">
							<i class="fa fa-github" aria-hidden="true"></i>
							GitHub 登录
						</a>
						<div class="forget">
							<a href="/account/forgetpwd" title="点击找回密码">忘记密码？</a>
						</div>
						<div class="register">
							<span>还不是会员</span><a href="/account/register">现在注册</a>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>
	<div id="sg-overlay"></div>
	
	
	<script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="https://cdn.staticfile.org/jquery-timeago/1.6.1/jquery.timeago.min.js"></script>
	<script src="https://cdn.staticfile.org/zoom.js/0.0.1/zoom.min.js"></script>
	<script src="https://cdn.staticfile.org/marked/0.3.6/marked.min.js"></script>
	<script src="https://cdn.staticfile.org/Caret.js/0.3.1/jquery.caret.min.js"></script>
	<script src="https://cdn.staticfile.org/emojify.js/1.1.0/js/emojify.min.js"></script>

	<script type="text/javascript">
	var uid =  0 ;
	var isHttps =  true ,
		cdnDomain = "https:\/\/static.studygolang.com\/";
	if (isHttps) {
		var wsUrl = 'wss://studygolang.com/ws?uid='+uid;
	} else {
		var wsUrl = 'ws://studygolang.com/ws?uid='+uid;
	}
	var GLaunchTime =  1540036286 *1000;
	</script>
	<script src="https://cdn.staticfile.org/lscache/1.1.0/lscache.min.js"></script>
	<script src="https://cdn.staticfile.org/jsrender/0.9.90/jsrender.min.js"></script>
	<script src="https://cdn.staticfile.org/plupload/3.1.1/plupload.full.min.js"></script>
	<script type="text/javascript">
	$.views.settings.delimiters("[%", "%]");
	
	</script>

	<script src="https://static.studygolang.com/static/dist/js/sg_libs.min.js"></script>
	<script src="https://static.studygolang.com/static/dist/js/sg_base.min.js?v=0.4"></script>

	

<script type="text/javascript" src="https://static.studygolang.com/static/dist/js/articles.min.js"></script>

<script type="text/javascript">

SG.SIDE_BARS = [
	"/rank/view",
];

var keyprefix = 'article';
var objid =  15792 ;

$(function(){
	
	
	
	$('.need-autogrow').autoGrow();
	
	loadComments();

	
	$('#wrapper .content').on('mousedown', 'a', function(evt){
		var url = $(this).attr('href');
		
		$(this).attr('href', url);
		$(this).attr('target', '_blank');
	});

	var len = 'golang boltdb的学习和实践1. 安装go get github.com\/boltdb\/bolt2.创建和启动数据库db, err := bolt.Open(\x22my.db\x22, 0600, nil)其中open的第一个参数为路径,如果数据库不存在则会创建名为my.db的数据库， 第二个为文件操作，第三个参数是可选参数， 内部可以配置只读和超时时间等，特别需要注意的地方就是因为boltdb是文件操作类型的数据库，所以只能单点写入和读取，如果多个同时操作的话后者会被挂起直到前者关闭操作为止， boltdb一次只允许一个读写事务，但一次允许多个只读事务。所以数据具有较强的一致性。因此单个事务和从它们创建的所有对象（例如桶、键）都不是线程安全的。与数据在多个概念你必须为每一个或使用锁机制来保证只有一个goroutine里操作改变数据。只读事务和读写事物通常不应该在同一个goroutine里同时打开。由于读写事务需要周期性地重新映射数据文件，这可能导致死锁。3.读写事务boltdb的读写事务操作我们可以使用DB.Update()来完成形如：err := db.Update(func(tx *bolt.Tx) error { ... return nil })在闭包fun中,在结束时返回nil来提交事务。您还可以通过返回一个错误在任何点回滚事务。所有数据库操作都允许在读写事务中进行。始终要关注err返回，因为它将报告导致您的事务不能完成的所有磁盘故障。4.批量读写事物每一次新的事物都需要等待上一次事物的结束，这种开销我们可以通过DB.Batch()批处理来完成err := db.Batch(func(tx *bolt.Tx) error { ... return nil })在批处理过程中如果某个事务失败了,批处理会多次调用这个函数函数返回成功则成功。如果中途失败了，则整个事务会回滚。5.只读事务只读事务可以使用DB.View()来完成err := db.View(func(tx *bolt.Tx) error { ... return nil })不改变数据的操作都可以通过只读事务来完成， 您只能检索桶、检索值，或在只读事务中复制数据库。6.启动事务DB.Begin()启动函数包含在db.update和db.batch中,该函数启动事务开始执行事务并返回结果关闭事务，这是boltdb推荐的方式，有时候你可能需要手动启动事物你可以使用Tx.Begin()来开始，切记不要忘记关闭事务。\/\/ Start a writable transaction. tx, err := db.Begin(true) if err != nil { return err } defer tx.Rollback() \/\/ Use the transaction... _, err := tx.CreateBucket([]byte(\x22MyBucket\x22)) if err != nil { return err } \/\/ Commit the transaction and check for error. if err := tx.Commit(); err != nil { return err }7.使用桶桶是数据库中键\/值对的集合。桶中的所有键必须是唯一的。您可以使用DB.CreateBucket()创建一个桶：db.Update(func(tx *bolt.Tx) error { b, err := tx.CreateBucket([]byte(\x22MyBucket\x22)) if err != nil { return fmt.Errorf(\x22create bucket: %s\x22, err) } return nil })你也可以是实用Tx.CreateBucketIfNotExists()来创建桶，该函数会先判断是否已经存在该桶不存在即创建， 删除桶可以使用Tx.DeleteBucket()来完成8.使用k-v对存储键值对到桶里可以使用Bucket.Put()来完成：db.Update(func(tx *bolt.Tx) error { b := tx.Bucket([]byte(\x22MyFriendsBucket\x22)) err := b.Put([]byte(\x22one\x22), []byte(\x22zhangsan\x22)) return err })获取键值Bucket.Get()：db.View(func(tx *bolt.Tx) error { b := tx.Bucket([]byte(\x22MyFriendsBucket\x22)) v := b.Get([]byte(\x22one\x22)) fmt.Printf(\x22The answer is: %s\\n\x22, v) return nil })get()函数不返回一个错误，因为它的运行是保证工作（除非有某种系统故障）。如果键存在，那么它将返回它的值。如果它不存在，那么它将返回nil。还需要注意的是当事务打开都get返回的值时唯一有效的，如果你需要将该值用于其他事务，你可以通过copy拷贝到其他的byte slice中9.桶的自增利用nextsequence()功能，你可以让boltdb生成序列作为你键值对的唯一标识。见下面的示例。func (s *Store) CreateUser(u *User) error { return s.db.Update(func(tx *bolt.Tx) error { \/\/ 创建users桶 b := tx.Bucket([]byte(\x22users\x22)) \/\/ 生成自增序列 id, _ = b.NextSequence() u.ID = int(id) \/\/ Marshal user data into bytes. buf, err := json.Marshal(u) if err != nil { return err } \/\/ Persist bytes to users bucket. return b.Put(itob(u.ID), buf) }) } \/\/ itob returns an 8-byte big endian representation of v. func itob(v int) []byte { b := make([]byte, 8) binary.BigEndian.PutUint64(b, uint64(v)) return b } type User struct { ID int ... }10. 迭代键boltdb以桶中的字节排序顺序存储键。这使得在这些键上的顺序迭代非常快。要遍历键，我们将使用游标Cursor()：db.View(func(tx *bolt.Tx) error { \/\/ Assume bucket exists and has keys b := tx.Bucket([]byte(\x22MyBucket\x22)) c := b.Cursor() for k, v := c.First(); k != nil; k, v = c.Next() { fmt.Printf(\x22key=%s, value=%s\\n\x22, k, v) } return nil })游标Cursor()允许您移动到键列表中的特定点，并一次一个地通过操作键前进或后退。光标上有以下函数：First() 移动到第一个健. Last() 移动到最后一个健. Seek() 移动到特定的一个健. Next() 移动到下一个健. Prev() 移动到上一个健.这些函数中的每一个都返回一个包含(key []byte, value []byte)的签名。当你有光标迭代结束，next()将返回一个nil。在调用next()或prev()之前，你必须寻求一个位置使用first()，last()，或seek()。如果您不寻求位置，则这些函数将返回一个nil键。在迭代过程中，如果键为非零，但值为0，则意味着键指向一个桶而不是一个值。用桶.bucket()访问子桶。11.前缀扫描遍历一个key的前缀，你可以结合seek()和bytes.hasprefix()：db.View(func(tx *bolt.Tx) error { \/\/ Assume bucket exists and has keys c := tx.Bucket([]byte(\x22MyBucket\x22)).Cursor() prefix := []byte(\x221234\x22) for k, v := c.Seek(prefix); bytes.HasPrefix(k, prefix); k, v = c.Next() { fmt.Printf(\x22key=%s, value=%s\\n\x22, k, v) } return nil })12.范围扫描另一个常见的用例是扫描范围，例如时间范围。如果你使用一个合适的时间编码，如rfc3339然后可以查询特定日期范围的数据：db.View(func(tx *bolt.Tx) error { \/\/ Assume our events bucket exists and has RFC3339 encoded time keys. c := tx.Bucket([]byte(\x22Events\x22)).Cursor() \/\/ Our time range spans the 90\x27s decade. min := []byte(\x221990-01-01T00:00:00Z\x22) max := []byte(\x222000-01-01T00:00:00Z\x22) \/\/ Iterate over the 90\x27s. for k, v := c.Seek(min); k != nil \x26\x26 bytes.Compare(k, max) \x3c= 0; k, v = c.Next() { fmt.Printf(\x22%s: %s\\n\x22, k, v) } return nil })13.循环遍历每一个如果你知道所在桶中拥有键，你也可以使用ForEach()来迭代：db.View(func(tx *bolt.Tx) error { \/\/ Assume bucket exists and has keys b := tx.Bucket([]byte(\x22MyBucket\x22)) b.ForEach(func(k, v []byte) error { fmt.Printf(\x22key=%s, value=%s\\n\x22, k, v) return nil }) return nil })14.嵌套桶还可以在一个键中存储一个桶，以创建嵌套的桶：func (*Bucket) CreateBucket(key []byte) (*Bucket, error) func (*Bucket) CreateBucketIfNotExists(key []byte) (*Bucket, error) func (*Bucket) DeleteBucket(key []byte) error15.数据库备份boltdb是一个单一的文件，所以很容易备份。你可以使用TX.writeto()函数写一致的数据库。如果从只读事务调用这个函数，它将执行热备份，而不会阻塞其他数据库的读写操作。默认情况下，它将使用一个常规文件句柄，该句柄将利用操作系统的页面缓存。有关优化大于RAM数据集的信息，请参见Tx文档。一个常见的用例是在HTTP上进行备份，这样您就可以使用像cURL这样的工具来进行数据库备份：func BackupHandleFunc(w http.ResponseWriter, req *http.Request) { err := db.View(func(tx *bolt.Tx) error { w.Header().Set(\x22Content-Type\x22, \x22application\/octet-stream\x22) w.Header().Set(\x22Content-Disposition\x22, `attachment; filename=\x22my.db\x22`) w.Header().Set(\x22Content-Length\x22, strconv.Itoa(int(tx.Size()))) _, err := tx.WriteTo(w) return err }) if err != nil { http.Error(w, err.Error(), http.StatusInternalServerError) } }然后您可以使用此命令进行备份：$ curl http:\/\/localhost\/backup \x3e my.db或者你可以打开你的浏览器以http:\/\/localhost\/backup，它会自动下载。如果你想备份到另一个文件，你可以使用TX.copyfile()辅助功能。16.统计数据库对运行的许多内部操作保持一个运行计数，这样您就可以更好地了解发生了什么。通过捕捉这些数据的快照，我们可以看到在这个时间范围内执行了哪些操作。例如，我们可以开始一个goroutine里记录统计每10秒：go func() { \/\/ Grab the initial stats. prev := db.Stats() for { \/\/ Wait for 10s. time.Sleep(10 * time.Second) \/\/ Grab the current stats and diff them. stats := db.Stats() diff := stats.Sub(\x26prev) \/\/ Encode stats to JSON and print to STDERR. json.NewEncoder(os.Stderr).Encode(diff) \/\/ Save stats for the next loop. prev = stats }17.只读模式有时创建一个共享的只读boltdb数据库是有用的。对此，设置options.readonly国旗打开数据库时。只读模式使用共享锁允许多个进程从数据库中读取，但它将阻塞任何以读写方式打开数据库的进程。db, err := bolt.Open(\x22my.db\x22, 0666, \x26bolt.Options{ReadOnly: true}) if err != nil { log.Fatal(err) }18.移动端支持（ios\/android）boltdb能够运行在移动设备上利用的工具结合特征GoMobile。创建一个结构体，包含您的数据库逻辑和参考一个bolt.db与初始化contstructor需要在文件路径，数据库文件将存储。使用这种方法，Android和iOS都不需要额外的权限或清理。func NewBoltDB(filepath string) *BoltDB { db, err := bolt.Open(filepath\x2b\x22\/demo.db\x22, 0600, nil) if err != nil { log.Fatal(err) } return \x26BoltDB{db} } type BoltDB struct { db *bolt.DB ... } func (b *BoltDB) Path() string { return b.db.Path() } func (b *BoltDB) Close() { b.db.Close() }数据库逻辑应定义为此包装器结构中的方法。要从本机语言初始化此结构（两个平台现在都将本地存储与云同步）。这些片段禁用数据库文件的功能）：AndroidString path; if (android.os.Build.VERSION.SDK_INT \x3e=android.os.Build.VERSION_CODES.LOLLIPOP){ path = getNoBackupFilesDir().getAbsolutePath(); } else{ path = getFilesDir().getAbsolutePath(); } Boltmobiledemo.BoltDB boltDB = Boltmobiledemo.NewBoltDB(path)IOS- (void)demo { NSString* path = [NSSearchPathForDirectoriesInDomains(NSLibraryDirectory, NSUserDomainMask, YES) objectAtIndex:0]; GoBoltmobiledemoBoltDB * demo = GoBoltmobiledemoNewBoltDB(path); [self addSkipBackupAttributeToItemAtPath:demo.path]; \/\/Some DB Logic would go here [demo close]; } - (BOOL)addSkipBackupAttributeToItemAtPath:(NSString *) filePathString { NSURL* URL= [NSURL fileURLWithPath: filePathString]; assert([[NSFileManager defaultManager] fileExistsAtPath: [URL path]]); NSError *error = nil; BOOL success = [URL setResourceValue: [NSNumber numberWithBool: YES] forKey: NSURLIsExcludedFromBackupKey error: \x26error]; if(!success){ NSLog(@\x22Error excluding %@ from backup %@\x22, [URL lastPathComponent], error); } return success; }19.查看工具1.下载工具go get github.com\/boltdb\/boltd然后编译cmd下的main文件生成可执行文件改名为boltd拷贝boltd到 *.db同级目录，执行如下：然后打开网站：2.命令行工具https:\/\/github.com\/hasit\/bolter'.length;
	var readTime = Math.round(len / 900);
	if (readTime >= 1) {
		$('.read-time').text('预计阅读时间 '+readTime+' 分钟');
	} else {
		$('.read-time').text('预计阅读时间不到 1 分钟');
	}
});
</script>
<script type="text/javascript" src="https://cdn.staticfile.org/ckeditor/4.6.2/ckeditor.js"></script>
<script type="text/javascript" src="https://static.studygolang.com/static/ckeditor/config.js"></script>
<script type="text/javascript" src="https://static.studygolang.com/static/ckeditor/article.js"></script>


<script type="text/javascript">
$(function(){
	$('code[class*="language-"]').parent('pre').addClass('line-numbers');
});
</script>
<script src="https://cdn.staticfile.org/prism/9000.0.1/prism.min.js"></script>
<script src="https://cdn.staticfile.org/prism/9000.0.1/components/prism-go.min.js"></script>
<script src="https://cdn.staticfile.org/prism/1.9.0/components/prism-json.min.js"></script>
<script src="https://cdn.staticfile.org/prism/9000.0.1/components/prism-bash.min.js"></script>
<script src="https://cdn.staticfile.org/prism/9000.0.1/components/prism-python.min.js"></script>
<script src="https://cdn.staticfile.org/prism/9000.0.1/components/prism-nasm.min.js"></script>
<script src="https://cdn.staticfile.org/prism/9000.0.1/components/prism-yaml.min.js"></script>
<script src="https://cdn.staticfile.org/prism/9000.0.1/plugins/line-numbers/prism-line-numbers.min.js"></script>

<script type="text/javascript">
Prism.languages.xml = Prism.languages.markup;
Prism.languages.html = Prism.languages.markup;
Prism.languages.mathml = Prism.languages.markup;
Prism.languages.svg = Prism.languages.markup;
Prism.languages.text = Prism.languages.go;
Prism.languages.golang = Prism.languages.go;
Prism.languages.none = Prism.languages.go;
Prism.languages.console = Prism.languages.bash;
Prism.languages.shell = Prism.languages.bash;
Prism.languages.asm = Prism.languages.nasm;
Prism.languages.makefile = Prism.languages.bash;
Prism.languages.Dockerfile = Prism.languages.bash;
Prism.languages.protobuf = Prism.languages.clike;
Prism.languages.c = Prism.languages.clike;
</script>



	



	




	<script type="text/javascript" src="https://static.studygolang.com/static/dist/js/sidebar.min.js?v=0.2"></script>

	
		
		

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-4512014793067058",
    enable_page_level_ads: true
  });
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-18275235-2', 'auto');
  ga('send', 'pageview');

</script>


<script>
var _hmt = _hmt || [];
if (uid > 0) {
	_hmt.push(['_setUserTag', ''+uid, 1]);
}

(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?224c227cd9239761ec770bc8c1fb134c";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script>
(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  } else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();
</script>

	

</body>
</html>
