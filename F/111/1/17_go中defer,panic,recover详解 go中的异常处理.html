<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<title>goä¸­defer,panic,recoverè¯¦è§£ goä¸­çš„å¼‚å¸¸å¤„ç†  - Goè¯­è¨€ä¸­æ–‡ç½‘ - Golangä¸­æ–‡ç¤¾åŒº</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
	<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
	<meta charset="utf-8">
	<link rel="shortcut icon" href="https://static.studygolang.com/img/favicon.ico">
	<link rel="apple-touch-icon" type="image/png" href="https://static.studygolang.com/static/img/logo2.png">
	<meta name="keywords" content="Go,Golang,Goè¯­è¨€">
<meta name="description" content="golangä¸­defer,panic,recoveræ˜¯å¾ˆå¸¸ç”¨çš„ä¸‰ä¸ªç‰¹æ€§ï¼Œä¸‰è€…ä¸€èµ·ä½¿ç”¨å¯ä»¥å……å½“å…¶ä»–è¯­è¨€ä¸­tryâ€¦catchâ€¦çš„è§’è‰²ï¼Œè€Œdeferæœ¬èº«åˆåƒå…¶ä»–è¯­è¨€çš„ææ„å‡½æ•° defer åœ¨å‡½æ•°è¿”å›ä¹‹å‰è°ƒç”¨ï¼Œç”¨äºèµ„æºé‡Šæ”¾ã€æ‰“å°æ—¥å¿—ã€å¼‚å¸¸æ•è·ç­‰ f, err := os.Open(filename) if err != nil { return err } /** * è¿™é‡Œdeferè¦å†™åœ¨erråˆ¤æ–­çš„åè¾¹">
	<meta name="author" content="polaris <polaris@studygolang.com>">
	<link rel="canonical" href="https://studygolang.com/" />

	
	<link rel="stylesheet" href="https://static.studygolang.com/cssjs/fonts_googleapi.css">
	<link rel="stylesheet" href="https://static.studygolang.com/cssjs/cosmo_bootstrap.min.css">
	<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://static.studygolang.com/static/dist/css/sg_libs.min.css"/>
	<link rel="stylesheet" href="https://static.studygolang.com/static/dist/css/sg_styles.min.css?v=0.3"/>
	
	

<style>
pre .line { margin: auto; line-height: 20px; border-bottom: none; }
.image-package .image-container-fill { padding-bottom: 0 !important; }
</style>



<link href="https://cdn.staticfile.org/prism/9000.0.1/themes/prism-okaidia.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/prism/9000.0.1/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">




	
	<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
	<script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
	
</head>
<body>
	<header class="navbar navbar-default navbar-fixed-top" role="navigation" style="position:relative;">
		<div class="container">
			
			<div class="navbar-header">
				<a href="/" class="navbar-brand" title="Goè¯­è¨€ä¸­æ–‡ç½‘"><img alt="Goè¯­è¨€ä¸­æ–‡ç½‘" src="https://static.studygolang.com/img/logo1.png" style="margin-top: -7px; height: 45px;"></a>
				<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
			</div>
			<div class="navbar-collapse collapse" id="navbar-main">
				<ul class="nav navbar-nav">
					<li class="">
						<a href="/topics">ä¸»é¢˜</a>
					</li>
					<li class="active">
						<a href="/articles">æ–‡ç« </a>
					</li>
					<li class="">
						<a href="/projects">é¡¹ç›®</a>
					</li>
					<li class="">
						<a href="/resources">èµ„æº</a>
					</li>
					<li class="">
						<a href="/books">å›¾ä¹¦</a>
					</li>
					<li class="dropdown ">
						
						<a class="dropdown-toggle" data-toggle="dropdown" href="#" id="readings">æ™¨è¯» <span class="caret"></span></a>
						<ul class="dropdown-menu" aria-labelledby="readings">
							<li><a href="/readings">Goæ™¨è¯»</a></li>
							<li><a href="/readings?rtype=1">ç»¼åˆæ™¨è¯»</a></li>
						</ul>
						
					</li>
					<li class="">
						<a href="/dl">ä¸‹è½½<i class="newfuture"></i></a>
					</li>
					<li class="dropdown ">
						<a class="dropdown-toggle" data-toggle="dropdown" href="#" id="docs">å®˜æ–¹æ–‡æ¡£ <span class="caret"></span></a>
						<ul class="dropdown-menu" aria-labelledby="docs">
						
							<li><a href="http://docs.studygolang.com" target="_blank">è‹±æ–‡æ–‡æ¡£</a></li>
							<li><a href="http://docscn.studygolang.com" target="_blank">ä¸­æ–‡æ–‡æ¡£</a></li>
							<li><a href="/pkgdoc">æ ‡å‡†åº“ä¸­æ–‡ç‰ˆ</a></li>
							<li role="presentation" class="divider"></li>
							<li><a href="http://tour.studygolang.com" target="_blank">GoæŒ‡å—</a></li>
						
						</ul>
					</li>
				</ul>
				<form class="navbar-form navbar-left" action="/search" role="search" target="_blank">
					<input type="text" name="q" class="form-control search-query" placeholder="æœç´¢" value="">
				</form>
				<ul class="nav navbar-nav navbar-right" id="userbar">
					
					<li class="first"><a href="/account/register">æ³¨å†Œ</a></li><li class="last"><a href="/account/login">ç™»å½•</a></li>
					
				</ul>
			</div>
		</div>
	</header>
	<div class="wrapper" id="wrapper">
		<div class="container" role="main">
		

			
<div class="row">
	<div class="col-md-9 col-sm-6">
		<div class="sep20"></div>
		<ol class="breadcrumb">
			<li><a href="/">é¦–é¡µ</a></li>
			<li><a href="/articles">æ–‡ç« </a></li>
		</ol>
		<div class="page">
			<div class="box_white">
				<div class="title">
					
					<h1 id="title" data-id="15776">
						goä¸­defer,panic,recoverè¯¦è§£ goä¸­çš„å¼‚å¸¸å¤„ç†
					</h1>
					<small class="c9">
					
						
						<span>smoke_zl</span>
						
					
						 Â· <span title="2018-10-25 10:34:44" class="timeago"></span> Â· 79 æ¬¡ç‚¹å‡» Â· 
						<span class="read-time"></span> Â· 
						<span class="timeago" title="2018-10-25 19:54:05"></span> å¼€å§‹æµè§ˆ &nbsp; &nbsp;
					
					</small>
				</div>
				
				<div class="cell">
					
					<div id="myeditor" class="content article-entry">
						<div class="show-content-free">
            <p>golangä¸­defer,panic,recoveræ˜¯å¾ˆå¸¸ç”¨çš„ä¸‰ä¸ªç‰¹æ€§ï¼Œä¸‰è€…ä¸€èµ·ä½¿ç”¨å¯ä»¥å……å½“å…¶ä»–è¯­è¨€ä¸­tryâ€¦catchâ€¦çš„è§’è‰²ï¼Œè€Œdeferæœ¬èº«åˆåƒå…¶ä»–è¯­è¨€çš„ææ„å‡½æ•°</p>
<h3>defer</h3>
<h6>åœ¨å‡½æ•°è¿”å›ä¹‹å‰è°ƒç”¨ï¼Œç”¨äºèµ„æºé‡Šæ”¾ã€æ‰“å°æ—¥å¿—ã€å¼‚å¸¸æ•è·ç­‰</h6>
<pre><code class="go">f, err := os.Open(filename)
if err != nil {
    return err
}
/**
 * è¿™é‡Œdeferè¦å†™åœ¨erråˆ¤æ–­çš„åè¾¹è€Œä¸æ˜¯os.Openåè¾¹
 * å¦‚æœèµ„æºæ²¡æœ‰è·å–æˆåŠŸï¼Œå°±æ²¡æœ‰å¿…è¦å¯¹èµ„æºæ‰§è¡Œé‡Šæ”¾æ“ä½œ
 * å¦‚æœerrä¸ä¸ºnilè€Œæ‰§è¡Œèµ„æºæ‰§è¡Œé‡Šæ”¾æ“ä½œï¼Œæœ‰å¯èƒ½å¯¼è‡´panic
 */
defer f.Close()
</code></pre>
<h6>å¦‚æœæœ‰å¤šä¸ªdeferè¡¨è¾¾å¼ï¼Œè°ƒç”¨é¡ºåºç±»ä¼¼äºæ ˆï¼Œè¶Šåé¢çš„deferè¡¨è¾¾å¼è¶Šå…ˆè¢«è°ƒç”¨(åè¿›å…ˆå‡º)</h6>
<pre><code class="go">func main() {
    defer fmt.Println(1)
    defer fmt.Println(2)
    defer fmt.Println(3)
    defer fmt.Println(4)
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>4
3
2
1
</code></pre>
<h6>å¦‚æœå«æœ‰ defer è¡¨è¾¾å¼çš„å‡½æ•°æœ‰è¿”å›å€¼ï¼Œdefer è¡¨è¾¾å¼å¯èƒ½ä¼šåœ¨è®¾ç½®å‡½æ•°è¿”å›å€¼ä¹‹åï¼Œåœ¨è¿”å›åˆ°è°ƒç”¨å‡½æ•°ä¹‹å‰ä¿®æ”¹è¿”å›å€¼ï¼Œä½¿æœ€ç»ˆçš„å‡½æ•°è¿”å›å€¼ä¸ä½ æƒ³è±¡çš„ä¸ä¸€è‡´ï¼Œè¿™é‡Œå¾ˆå®¹æ˜“è¸©å‘ï¼Œæ¥å‡ ä¸ªğŸŒ°</h6>
<p>ä¾‹1</p>
<pre><code class="go">func f() (result int) {
    defer func() {
        result++
    }()
    return 0
}
</code></pre>
<p>ä¾‹2</p>
<pre><code>func f() (r int) {
    t := 5
    defer func() {
        t = t + 5
    }()
    return t
}
</code></pre>
<p>ä¾‹3</p>
<pre><code>func f() (r int) {
    defer func(r int) {
        r = r + 5
    }(r)
    return 1
}
</code></pre>
<p>è¯·å…ˆä¸è¦å‘ä¸‹çœ‹ï¼Œåœ¨å¿ƒé‡Œè·‘ä¸€éç»“æœï¼Œç„¶åå»éªŒè¯<br/>
<strong>1çš„æ­£ç¡®ç­”æ¡ˆä¸æ˜¯0ï¼Œ2çš„æ­£ç¡®ç­”æ¡ˆä¸æ˜¯10ï¼Œ3çš„æ­£ç¡®ç­”æ¡ˆä¸æ˜¯6</strong><br/>
ä¸ºä»€ä¹ˆå‘¢ï¼Œæœ€é‡è¦çš„ä¸€ç‚¹å°±æ˜¯è¦æ˜ç™½ï¼Œ<strong>return xxxè¿™ä¸€æ¡è¯­å¥å¹¶ä¸æ˜¯ä¸€æ¡åŸå­æŒ‡ä»¤</strong><br/>
å«æœ‰deferè¡¨è¾¾å¼çš„å‡½æ•°è¿”å›çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šå…ˆç»™è¿”å›å€¼èµ‹å€¼ï¼Œç„¶åè°ƒç”¨deferè¡¨è¾¾å¼ï¼Œæœ€åæ‰æ˜¯è¿”å›åˆ°è°ƒç”¨å‡½æ•°ä¸­ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„è½¬æ¢è§„åˆ™å°†return xxxæ”¹å†™æˆ</p>
<pre><code>è¿”å›å€¼ = xxx
è°ƒç”¨deferå‡½æ•°
ç©ºçš„return
</code></pre>
<p>ä¾‹1ï¼Œå®ƒå¯ä»¥æ”¹å†™æˆè¿™æ ·</p>
<pre><code class="go">func f() (result int) {
    //returnè¯­å¥ä¸æ˜¯ä¸€æ¡åŸå­è°ƒç”¨ï¼Œreturn xxxå…¶å®æ˜¯èµ‹å€¼ï¼‹retæŒ‡ä»¤
    result = 0
    //deferè¢«æ’å…¥åˆ°returnä¹‹å‰æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯èµ‹è¿”å›å€¼å’ŒretæŒ‡ä»¤ä¹‹é—´
    func() {
        result++
    }()
    return
}
</code></pre>
<p>æ‰€ä»¥è¿™ä¸ªè¿”å›å€¼æ˜¯1<br/>
ä¾‹2ï¼Œå®ƒå¯ä»¥æ”¹å†™æˆè¿™æ ·</p>
<pre><code class="go">func f() (r int) {
    t := 5
    //èµ‹å€¼æŒ‡ä»¤
    r = t
    //deferè¢«æ’å…¥åˆ°èµ‹å€¼ä¸è¿”å›ä¹‹é—´æ‰§è¡Œï¼Œè¿™ä¸ªä¾‹å­ä¸­è¿”å›å€¼ræ²¡è¢«ä¿®æ”¹è¿‡
    func() {
        t = t + 5
    }
    return
}
</code></pre>
<p>æ‰€ä»¥è¿™ä¸ªçš„ç»“æœæ˜¯5<br/>
ä¾‹3ï¼Œå®ƒå¯ä»¥æ”¹å†™æˆè¿™æ ·</p>
<pre><code class="go">func f() (r int) {
    //ç»™è¿”å›å€¼èµ‹å€¼
    r = 1
    //è¿™é‡Œæ”¹çš„ræ˜¯ä¼ å€¼ä¼ è¿›å»çš„r(funcé‡Œè¾¹çš„ræ˜¯ä½œç”¨åŸŸä¸åŒçš„é‡åå˜é‡)ï¼Œä¸ä¼šæ”¹å˜è¦è¿”å›çš„é‚£ä¸ªrå€¼
    func(r int) {
        r = r + 5
    }(r)
    return
}
</code></pre>
<p>æ‰€ä»¥è¿™ä¸ªä¾‹å­çš„ç»“æœæ˜¯1<br/>
deferè¢«æ’å…¥åˆ°äº†èµ‹å€¼ä¸retä¹‹é—´ï¼Œå› æ­¤å¯èƒ½æœ‰æœºä¼šæ”¹å˜æœ€ç»ˆçš„è¿”å›å€¼</p>
<h6>deferå‡½æ•°çš„å‚æ•°å€¼ï¼Œæ˜¯åœ¨ç”³æ˜deferæ—¶ç¡®å®šä¸‹æ¥çš„</h6>
<p>åœ¨deferå‡½æ•°ç”³æ˜æ—¶ï¼Œå¯¹å¤–éƒ¨å˜é‡çš„å¼•ç”¨æ˜¯æœ‰ä¸¤ç§æ–¹å¼ï¼šä½œä¸ºå‡½æ•°å‚æ•°å’Œä½œä¸ºé—­åŒ…å¼•ç”¨<br/>
ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œåœ¨deferç”³æ˜æ—¶å°±æŠŠå€¼ä¼ é€’ç»™deferï¼Œå¹¶å°†å€¼ç¼“å­˜èµ·æ¥ï¼Œè°ƒç”¨deferçš„æ—¶å€™ä½¿ç”¨ç¼“å­˜çš„å€¼è¿›è¡Œè®¡ç®—<br/>
ä½œä¸ºé—­åŒ…å¼•ç”¨ï¼Œåœ¨deferå‡½æ•°æ‰§è¡Œæ—¶æ ¹æ®æ•´ä¸ªä¸Šä¸‹æ–‡ç¡®å®šå½“å‰çš„å€¼<br/>
çœ‹ä¸ªğŸŒ°</p>
<pre><code class="go">func main() {
    i := 0
    defer fmt.Println(&#34;a:&#34;, i)
    //é—­åŒ…è°ƒç”¨ï¼Œå°†å¤–éƒ¨iä¼ åˆ°é—­åŒ…ä¸­è¿›è¡Œè®¡ç®—
    defer func(j int) {
        fmt.Println(&#34;b:&#34;, j)
    }(i)
    //é—­åŒ…è°ƒç”¨ï¼Œæ•è·åŒä½œç”¨åŸŸä¸‹çš„iè¿›è¡Œè®¡ç®—
    defer func() {
        fmt.Println(&#34;c:&#34;, i)
    }()
    i++
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>c: 1
b: 0
a: 0
</code></pre>
<p>è¯´æ˜åœ°å€ï¼š<a href="https://www.jianshu.com/p/63e3d57f285f" target="_blank">https://www.jianshu.com/p/63e3d57f285f</a></p>
<h3>panicå’Œrecover</h3>
<pre><code class="go">func panic(v interface{})
</code></pre>
<blockquote>
<p>ä¸­è‹±æ–‡è¯´æ˜<br/>
The panic built-in function stops normal execution of the current goroutine.When a function F calls panic, normal execution of F stops immediately.Any functions whose execution was deferred by F are run in the usual way, and then F returns to its caller. To the caller G, the invocation of F then behaves like a call to panic,terminating G&#39;s execution and running any deferred functions.This continues until all functions in the executing goroutine have stopped,in reverse order. At that point, the program is terminated and the error condition is reported,including the value of the argument to panic. This termination sequence is called panicking and can be controlled by the built-in function recover.<br/>
panicå†…ç½®å‡½æ•°åœæ­¢å½“å‰goroutineçš„æ­£å¸¸æ‰§è¡Œï¼Œå½“å‡½æ•°Fè°ƒç”¨panicæ—¶ï¼Œå‡½æ•°Fçš„æ­£å¸¸æ‰§è¡Œè¢«ç«‹å³åœæ­¢ï¼Œç„¶åè¿è¡Œæ‰€æœ‰åœ¨Få‡½æ•°ä¸­çš„deferå‡½æ•°ï¼Œç„¶åFè¿”å›åˆ°è°ƒç”¨ä»–çš„å‡½æ•°å¯¹äºè°ƒç”¨è€…Gï¼ŒFå‡½æ•°çš„è¡Œä¸ºå°±åƒpanicä¸€æ ·ï¼Œç»ˆæ­¢Gçš„æ‰§è¡Œå¹¶è¿è¡ŒGä¸­æ‰€deferå‡½æ•°ï¼Œæ­¤è¿‡ç¨‹ä¼šä¸€ç›´ç»§ç»­æ‰§è¡Œåˆ°goroutineæ‰€æœ‰çš„å‡½æ•°ã€‚panicå¯ä»¥é€šè¿‡å†…ç½®çš„recoveræ¥æ•è·ã€‚</p>
</blockquote>
<pre><code class="go">func recover() interface{}
</code></pre>
<blockquote>
<p>ä¸­è‹±æ–‡è¯´æ˜<br/>
The recover built-in function allows a program to manage behavior of a panicking goroutine. Executing a call to recover inside a deferred function (but not any function called by it) stops the panicking sequence by restoring normal execution and retrieves the error value passed to the call of panic. If recover is called outside the deferred function it will not stop a panicking sequence. In this case, or when the goroutine is not panicking, or if the argument supplied to panic was nil, recover returns nil. Thus the return value from recover reports whether the goroutine is panicking.<br/>
recoverå†…ç½®å‡½æ•°ç”¨æ¥ç®¡ç†å«æœ‰panicè¡Œä¸ºçš„goroutineï¼Œrecoverè¿è¡Œåœ¨deferå‡½æ•°ä¸­ï¼Œè·å–panicæŠ›å‡ºçš„é”™è¯¯å€¼ï¼Œå¹¶å°†ç¨‹åºæ¢å¤æˆæ­£å¸¸æ‰§è¡Œçš„çŠ¶æ€ã€‚å¦‚æœåœ¨deferå‡½æ•°ä¹‹å¤–è°ƒç”¨recoverï¼Œé‚£ä¹ˆrecoverä¸ä¼šåœæ­¢å¹¶ä¸”æ•è·panicé”™è¯¯å¦‚æœgoroutineä¸­æ²¡æœ‰panicæˆ–è€…æ•è·çš„panicçš„å€¼ä¸ºnilï¼Œrecoverçš„è¿”å›å€¼ä¹Ÿæ˜¯nilã€‚ç”±æ­¤å¯è§ï¼Œrecoverçš„è¿”å›å€¼è¡¨ç¤ºå½“å‰goroutineæ˜¯å¦æœ‰panicè¡Œä¸º</p>
</blockquote>
<p>è¿™é‡Œæœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜ï¼Œé€šè¿‡ğŸŒ°è¡¨ç°</p>
<h6>defer è¡¨è¾¾å¼çš„å‡½æ•°å¦‚æœå®šä¹‰åœ¨ panic åé¢ï¼Œè¯¥å‡½æ•°åœ¨ panic åå°±æ— æ³•è¢«æ‰§è¡Œåˆ°</h6>
<p>åœ¨deferå‰panic</p>
<pre><code class="go">func main() {
    panic(&#34;a&#34;)
    defer func() {
        fmt.Println(&#34;b&#34;)
    }()
}
</code></pre>
<p>bæ²¡æœ‰è¢«æ‰“å°å‡ºæ¥ï¼Œç»“æœï¼š</p>
<pre><code>panic: a

goroutine 1 [running]:
main.main()
    /xxxxx/src/xxx.go:50 +0x39
exit status 2
</code></pre>
<p>åœ¨deferåpanic</p>
<pre><code class="go">func main() {
    defer func() {
        fmt.Println(&#34;b&#34;)
    }()
    panic(&#34;a&#34;)
}
</code></pre>
<p>bè¢«æ­£å¸¸æ‰“å°ï¼Œç»“æœï¼š</p>
<pre><code>b
panic: a

goroutine 1 [running]:
main.main()
    /xxxxx/src/xxx.go:50 +0x39
exit status 2
</code></pre>
<h6>Fä¸­å‡ºç°panicæ—¶ï¼ŒFå‡½æ•°ä¼šç«‹åˆ»ç»ˆæ­¢ï¼Œä¸ä¼šæ‰§è¡ŒFå‡½æ•°ä¸­åé¢çš„å†…å®¹ï¼Œä½†ä¸ä¼šç«‹åˆ»è¿”å›ï¼Œè€Œè°ƒç”¨Fçš„deferï¼Œå¦‚æœFçš„deferä¸­æœ‰recoveræ•è·ï¼Œåˆ™Fåœ¨æ‰§è¡Œå®Œdeferåæ­£å¸¸è¿”å›ï¼Œè°ƒç”¨å‡½æ•°Fçš„å‡½æ•°Gç»§ç»­æ­£å¸¸æ‰§è¡Œ</h6>
<pre><code class="go">func G() {
    defer func() {
        fmt.Println(&#34;c&#34;)
    }()
    F()
    fmt.Println(&#34;ç»§ç»­æ‰§è¡Œ&#34;)
}

func F() {
    defer func() {
        if err := recover(); err != nil {
            fmt.Println(&#34;æ•è·å¼‚å¸¸:&#34;, err)
        }
        fmt.Println(&#34;b&#34;)
    }()
    panic(&#34;a&#34;)
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>æ•è·å¼‚å¸¸: a
b
ç»§ç»­æ‰§è¡Œ
c
</code></pre>
<h6>å¦‚æœFçš„deferä¸­æ— recoveræ•è·ï¼Œåˆ™å°†panicæŠ›åˆ°Gä¸­ï¼ŒGå‡½æ•°ä¼šç«‹åˆ»ç»ˆæ­¢ï¼Œä¸ä¼šæ‰§è¡ŒGå‡½æ•°ä¸­åé¢çš„å†…å®¹ï¼Œä½†ä¸ä¼šç«‹åˆ»è¿”å›ï¼Œè€Œè°ƒç”¨Gçš„defer...ä»¥æ­¤ç±»æ¨</h6>
<pre><code class="go">func G() {
    defer func() {
        if err := recover(); err != nil {
            fmt.Println(&#34;æ•è·å¼‚å¸¸:&#34;, err)
        }
        fmt.Println(&#34;c&#34;)
    }()
    F()
    fmt.Println(&#34;ç»§ç»­æ‰§è¡Œ&#34;)
}

func F() {
    defer func() {
        fmt.Println(&#34;b&#34;)
    }()
    panic(&#34;a&#34;)
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>b
æ•è·å¼‚å¸¸: a
c
</code></pre>
<h6>å¦‚æœä¸€ç›´æ²¡æœ‰recoverï¼ŒæŠ›å‡ºçš„panicåˆ°å½“å‰goroutineæœ€ä¸Šå±‚å‡½æ•°æ—¶ï¼Œç¨‹åºç›´æ¥å¼‚å¸¸ç»ˆæ­¢</h6>
<pre><code class="go">func G() {
    defer func() {
        fmt.Println(&#34;c&#34;)
    }()
    F()
    fmt.Println(&#34;ç»§ç»­æ‰§è¡Œ&#34;)
}

func F() {
    defer func() {
        fmt.Println(&#34;b&#34;)
    }()
    panic(&#34;a&#34;)
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>b
c
panic: a

goroutine 1 [running]:
main.F()
    /xxxxx/src/xxx.go:61 +0x55
main.G()
    /xxxxx/src/xxx.go:53 +0x42
exit status 2
</code></pre>
<h6>recoveréƒ½æ˜¯åœ¨<code>å½“å‰çš„goroutine</code>é‡Œè¿›è¡Œæ•è·çš„ï¼Œè¿™å°±æ˜¯è¯´ï¼Œå¯¹äºåˆ›å»ºgoroutineçš„å¤–å±‚å‡½æ•°ï¼Œå¦‚æœgoroutineå†…éƒ¨å‘ç”Ÿpanicå¹¶ä¸”å†…éƒ¨æ²¡æœ‰ç”¨recoverï¼Œå¤–å±‚å‡½æ•°æ˜¯æ— æ³•ç”¨recoveræ¥æ•è·çš„ï¼Œè¿™æ ·ä¼šé€ æˆç¨‹åºå´©æºƒ</h6>
<pre><code>func G() {
    defer func() {
        //goroutineå¤–è¿›è¡Œrecover
        if err := recover(); err != nil {
            fmt.Println(&#34;æ•è·å¼‚å¸¸:&#34;, err)
        }
        fmt.Println(&#34;c&#34;)
    }()
    //åˆ›å»ºgoroutineè°ƒç”¨Få‡½æ•°
    go F()
    time.Sleep(time.Second)
}

func F() {
    defer func() {
        fmt.Println(&#34;b&#34;)
    }()
    //goroutineå†…éƒ¨æŠ›å‡ºpanic
    panic(&#34;a&#34;)
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>b
panic: a

goroutine 5 [running]:
main.F()
    /xxxxx/src/xxx.go:67 +0x55
created by main.main
    /xxxxx/src/xxx.go:58 +0x51
exit status 2
</code></pre>
<h6>recoverè¿”å›çš„æ˜¯interface{}ç±»å‹è€Œä¸æ˜¯goä¸­çš„ error ç±»å‹ï¼Œå¦‚æœå¤–å±‚å‡½æ•°éœ€è¦è°ƒç”¨err.Error()ï¼Œä¼šç¼–è¯‘é”™è¯¯ï¼Œä¹Ÿå¯èƒ½ä¼šåœ¨æ‰§è¡Œæ—¶panic</h6>
<pre><code>func main() {
    defer func() {
        if err := recover(); err != nil {
            fmt.Println(&#34;æ•è·å¼‚å¸¸:&#34;, err.Error())
        }
    }()
    panic(&#34;a&#34;)
}
</code></pre>
<p>ç¼–è¯‘é”™è¯¯ï¼Œç»“æœï¼š</p>
<pre><code>err.Error undefined (type interface {} is interface with no methods)
</code></pre>
<pre><code>func main() {
    defer func() {
        if err := recover(); err != nil {
            fmt.Println(&#34;æ•è·å¼‚å¸¸:&#34;, fmt.Errorf(&#34;%v&#34;, err).Error())
        }
    }()
    panic(&#34;a&#34;)
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>æ•è·å¼‚å¸¸: a
</code></pre>
<p>å‚è€ƒï¼š<br/>
https: //golang.org/pkg/builtin/#recover<br/>
https: <a href="//www.w3cschool.cn/go_internals/go_internals-drq7282o.html" target="_blank" rel="nofollow">//www.w3cschool.cn/go_internals/go_internals-drq7282o.html</a></p>

          </div>
					</div>
					

					
					<div class="row orig-info">
						<p>æœ¬æ–‡æ¥è‡ªï¼š<a href="/wr?u=http://www.jianshu.com" target="_blank" title="ç®€ä¹¦">ç®€ä¹¦</a></p>
						<p>æ„Ÿè°¢ä½œè€…ï¼šsmoke_zl</p>
						<p>æŸ¥çœ‹åŸæ–‡ï¼š<a href="/wr?u=https%3a%2f%2fwww.jianshu.com%2fp%2f63e3d57f285f" target="_blank" title="goä¸­defer,panic,recoverè¯¦è§£ goä¸­çš„å¼‚å¸¸å¤„ç†">goä¸­defer,panic,recoverè¯¦è§£ goä¸­çš„å¼‚å¸¸å¤„ç†</a></p>
					</div>
					
				</div>
				
				<div class="content-buttons">
					<div class="pull-right c9 f11" style="line-height: 12px; padding-top: 3px; text-shadow: 0px 1px 0px #fff;">79 æ¬¡ç‚¹å‡» &nbsp;</div>
					<a class="tb collect" href="javascript:;" title="åŠ å…¥æ”¶è—" data-objid="15776" data-objtype="1" data-collect="">åŠ å…¥æ”¶è—</a> 
					<a href="javascript:" onclick="window.open('http://service.weibo.com/share/share.php?url=https://studygolang.com/articles/15776&title='+encodeURIComponent('Goè¯­è¨€ä¸­æ–‡ç½‘ - goä¸­defer,panic,recoverè¯¦è§£ goä¸­çš„å¼‚å¸¸å¤„ç† by smoke_zl #golang#'), '_blank', 'width=550,height=370');" class="tb">å¾®åš</a>
					<div id="content-thank">
						<a class="tb" href="javascript:;" title="èµ" data-objid="15776" data-objtype="1" data-flag="">èµ</a>
					</div>
				</div>
			</div>
			

			<div class="sep20"></div>
			<div class="box_white">
				<div class="cell subject">
					
					<div class="item-list">
					
						<a class="add-collection" href="javascript:"><i class="fa fa-plus"></i> æ”¶å…¥æˆ‘çš„ä¸“æ </a>
					</div>
				</div>
			</div>

			<div class="sep20"></div>
			<div class="box_white">
				<div class="cell row">
					
					<div class="col-sm-6">ä¸Šä¸€ç¯‡ï¼š<a href="/articles/15775">åˆè¯†Goè¯­è¨€-1</a></div>
					
					
					<div class="col-sm-6 right">ä¸‹ä¸€ç¯‡ï¼š<a href="/articles/15777">GOè¯­è¨€é¢è¯•ç³»åˆ—:ï¼ˆäºŒï¼‰å¸¸è§„æ€§Golangé¢è¯•é¢˜è§£æ</a></div>
					
				</div>
			</div>

			<div class="sep20"></div>

			
			<div id="replies" class="box_white">
				<div class="cell">
					<div class="pull-right" style="margin: -3px -5px 0px 0px;">
					
						
						
						<a href="/tag/%e5%87%bd%e6%95%b0" class="tag"><li class="fa fa-tag"></li> å‡½æ•°</a>
						
						<a href="/tag/goroutine" class="tag"><li class="fa fa-tag"></li> goroutine</a>
						
						<a href="/tag/%e8%bf%94%e5%9b%9e%e5%80%bc" class="tag"><li class="fa fa-tag"></li> è¿”å›å€¼</a>
						
						<a href="/tag/%e6%8a%9b%e5%87%ba" class="tag"><li class="fa fa-tag"></li> æŠ›å‡º</a>
						
					
					</div>
					<span class="c9"><span class="cmtnum">1</span> å›å¤ &nbsp;<strong class="snow">|</strong> &nbsp;ç›´åˆ° 2018-10-25 11:59:01</span>
				</div>
				<div class="comment-list cell" data-objid="15776" data-objtype="1" >
					<div class="words hide"><div class="text-center">æš‚æ— å›å¤</div></div>
				</div>
			</div>

			
			
<div class="sep10"></div>
<div class="box_white page-comment">
	<input type="hidden" name="me-uid" value="0"/>
	<div class="cell">æ·»åŠ ä¸€æ¡æ–°å›å¤
	
	<span class="h2-tip">
	ï¼ˆæ‚¨éœ€è¦ <a class="c-log" href="javascript:openPop('#login-pop');">ç™»å½•</a> åæ‰èƒ½å›å¤ <a href="/user/register" class="c-reg"> æ²¡æœ‰è´¦å·</a> ï¼Ÿï¼‰</span>
	
	</div>
	<div class="cell">
		<div class="row clearfix md-toolbar">
			<ul class="col-md-10 list-inline comment-tab-menu" data-comment-group="default">
				<li class="comment-edit-tab cur"><a href="#" class="op">ç¼–è¾‘</a></li>
				<li class="comment-preview-tab"><a href="#" class="op">é¢„è§ˆ</a></li>
				<li>
					<div class="nav reply-to dn" data-floor="" data-username="">
						<i class="fa fa-mail-reply" title=""></i>
						<a href="#reply" class="user" title=""></a>
						<a href="#" class="close"><i class="fa fa-close"></i></a>
					</div>
				</li>
			</ul>
			<div class="col-md-2 text-right">
				<i id="upload-img" class="glyphicon glyphicon-picture upload-img tool-tip" data-toggle="tooltip" data-placement="top" title="ä¸Šä¼ å›¾ç‰‡"></i>
			</div>
		</div>
		<div class="submit" id="commentForm">
			<div class="comment-content-text" data-comment-group="default">
				<textarea id="comment-content" name="content" class="comment-textarea main-textarea need-autogrow" rows="8"></textarea>
			</div>
			<div class="comment-content-preview cell" data-comment-group="default"></div>
			<div class="sub row">
				<ul class="help-block col-md-10">
					<li>è¯·å°½é‡è®©è‡ªå·±çš„å›å¤èƒ½å¤Ÿå¯¹åˆ«äººæœ‰å¸®åŠ©</li>
					<li class="markdown_tip">æ”¯æŒ Markdown æ ¼å¼, <strong>**ç²—ä½“**</strong>ã€~~åˆ é™¤çº¿~~ã€<code>`å•è¡Œä»£ç `</code></li>
					<li>æ”¯æŒ @ æœ¬ç«™ç”¨æˆ·ï¼›æ”¯æŒè¡¨æƒ…ï¼ˆè¾“å…¥ : æç¤ºï¼‰ï¼Œè§ <a href="http://www.emoji-cheat-sheet.com/" target="_blank">Emoji cheat sheet</a></li>
					<li>å›¾ç‰‡æ”¯æŒæ‹–æ‹½ã€æˆªå›¾ç²˜è´´ç­‰æ–¹å¼ä¸Šä¼ </li>
				</ul>
				<div class="col-md-2 text-right"><button id="comment-submit" type="submit" title="æäº¤" class="btn btn-default">æäº¤</button></div>
			</div>
		</div>
	</div>
</div>

<style type="text/css">
#replies { margin-bottom: 15px; }
#replies .reply {
	margin: 0 -15px;
	padding: 15px 15px;
	position: relative;
	border-bottom: 1px solid #eee;
	padding-left: 74px;
}
#replies .reply .avatar {
	position: absolute;
	top: 15px;
	left: 15px;
}
.avatar-48 {
	width: 48px;
	height: 48px;
	border-radius: 120px;
}
.media-object {
	display: block;
}
.avatar-16 {
	width: 16px;
	height: 16px;
	border-radius: 120px;
}
#replies .reply .reply-to-block .info .media-object {
	display: inline-block;
	margin-right: 5px;
	vertical-align: top;
}
#replies .reply .reply-to-block .info {
	margin: 0;
}
#replies .reply .reply-to-block .info .user-name {
	font-weight: bold;
}
#replies .reply .reply-to-block {
	padding: 8px 15px;
	background: #f7f7f7;
	border-radius: 3px;
	margin-bottom: 10px;
}
.avatar .uface, .avatar .media-object {
	border-radius: 120px;
}
#replies .reply .infos {
	min-height: 48px;
}
#replies .reply .info {
	color: #999;
	margin-bottom: 6px;
	font-size: 12px;
}
#replies .reply .info .name {
	font-weight: bold;
	font-size: 13px;
}
#replies .reply .info .name a {
	color: #555;
}
#replies .reply .info .floor {
	color: #7AA87A;
}
#replies .reply .info a.time {
	color: #999;
	border-bottom: 1px dashed #ccc;
	text-decoration: none !important;
	cursor: pointer;
}
abbr[title] {
	border-bottom: 0px;
	cursor: pointer;
}
.opts {
	color: #666;
}
@media (min-width: 1026px) {
	#replies .reply .hideable {
		display: none;
	}
}
#replies .reply .opts a {
	display: inline-block;
	vertical-align: baseline;
	line-height: 22px;
	padding: 2px 5px;
	height: 22px;
	min-width: 22px;
	text-align: center;
}
#replies .info .opts a {
	font-size: 13px;
	margin-left: 5px;
	color: #999;
}
#replies .info .opts a.edit {
	display: none;
}
.markdown {
	position: relative;
	letter-spacing: .03em;
	font-size: 15px;
	text-overflow: ellipsis;
	word-wrap: break-word;
}
.markdown img.twemoji {
	width: 20px;
}
.markdown img {
	vertical-align: top;
	max-width: 100%;
}
.markdown p {
	font-size: 14px;
	line-height: 26px;
	margin-bottom: 0;
	color: #000;
}
.md-toolbar .reply-to {
    padding-top: 3px;
    padding-left: 8px;
}
.close {
    float: right;
    font-size: 21px;
    font-weight: 700;
    line-height: 1;
    color: #000;
    text-shadow: 0 1px 0 #fff;
    filter: alpha(opacity=20);
    opacity: .2;
}
a.close:hover {
	background-color: #d0d0d0;
    color: #666
}
.md-toolbar .reply-to .close {
    font-size: 14px;
    margin-left: 5px;
    margin-top: 1px;
}
.edit-wrapper {
	display: none;
	border: 1px solid #c0d3eb;
	padding: 8px;
	border-radius: 4px;
}

.edit-textarea {
	resize: none;
	width: 100%;
	color: #000;
	font-size: 14px;
	border: 1px solid #E5E5E5;
	padding: 5px;
}
.btn-edit {
	cursor: pointer;
}


</style>

<script type="text/x-jsrender" id="one-comment">
<div class="reply [%if is_new%]light[%/if%]" id="reply-[%:comment.floor%]">
	<div data-floor="[%:comment.floor%]">
		<div class="avatar"><a title="[%:user.username%]" href="/user/[%:user.username%]"><img class="media-object avatar-48" src="[%:user.avatar%]" alt="[%:user.username%]"></a></div>
			<div class="infos">
				<div class="info">
					<span class="name">
						<a class="user-name" data-name="[%:user.name%]" href="/user/[%:user.username%]">[%:user.username%]</a>
					</span> Â·
					<span class="floor">#[%:comment.floor%]</span> Â·
					<abbr class="timeago" title="[%:comment.ctime%]">[%:comment.cmt_time%]</abbr>
					<span class="opts pull-right">
						<span class="op-reply hideable">
							[%if me.uid == user.uid %]
								<a data-floor="[%:comment.floor%]" title="ç¼–è¾‘" class="btn-edit glyphicon glyphicon-edit"></a>
							[%/if%]
						  <a data-floor="[%:comment.floor%]" data-username="[%:user.username%]" title="å›å¤æ­¤æ¥¼" class="btn-reply fa fa-mail-reply" href="#"></a>
						</span>
						
					</span>
				</div>
				[%if comment.reply_floor > 0%]
				<div class="reply-to-block">
					<div class="info reply_user">
						å¯¹
						<a data-remote="true" href="/user/[%:comment.reply_user.username%]">
							<img class="media-object avatar-16" src="[%:comment.reply_user.avatar%]" alt="[%:comment.reply_user.username%]"><span class="user-name">[%:comment.reply_user.username%]</span>
						</a>
						<a href="#reply-[%:comment.reply_floor%]"><span class="reply-floor">#[%:comment.reply_floor%]</span></a> å›å¤
					</div>
					<div class="markdown dn">
						<p>[%:comment.reply_content%]</p>
					</div>
				</div>
				[%/if%]

			<div class="markdown" data-floor="[%:comment.floor%]">
				<div class="content">[%:comment.content%]</div>
				<div class="edit-wrapper">
					<div class="row clearfix md-toolbar">
						<ul class="col-md-10 list-inline comment-tab-menu" data-comment-group="[%:comment.floor%]">
								<li class="comment-edit-tab cur"><a href="#" class="op">ç¼–è¾‘</a></li>
								<li class="comment-preview-tab"><a href="#" class="op">é¢„è§ˆ</a></li>
						</ul>
						<div class="col-md-2 text-right">
							<i data-floor="[%:comment.floor%]" class="glyphicon glyphicon-picture upload-img tool-tip" data-toggle="tooltip" data-placement="top" title="ä¸Šä¼ å›¾ç‰‡"></i>
						</div>
					</div>
					<div class="comment-content-text" data-comment-group="[%:comment.floor%]">
						<textarea data-raw-content="[%:comment.rawContent%]" name="content" class="comment-textarea" rows="8" style="width: 100%;">[%:comment.rawContent%]</textarea>
					</div>
					<div class="comment-content-preview cell" data-comment-group="[%:comment.floor%]"></div>
					<div class="text-right">
						<button type="submit" title="æäº¤" data-cid="[%:comment.cid%]" data-floor="[%:comment.floor%]" class="submit btn btn-default">æäº¤</button>
						<button title="å–æ¶ˆ" data-floor="[%:comment.floor%]" class="cancel btn btn-default">å–æ¶ˆ</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</script>


			

			
		</div>
	</div>
	<div class="col-md-3 col-sm-6">
		<div class="sep20"></div>
		<div class="box_white sidebar">
	
	<div class="top">
		<h3 class="title"><i class="glyphicon glyphicon-user"></i> ç”¨æˆ·ç™»å½•</h3>
	</div>
	<div class="sb-content inner_content" style="padding-bottom: 0;">
		<form action="/account/login" method="post" class="form-horizontal login" role="form" style="padding-top: 0; padding-bottom: 0;">
			<div class="form-group">
				<div class="col-sm-10">
					<input type="text" class="form-control input-sm" id="username" name="username" placeholder="è¯·å¡«å†™ç”¨æˆ·åæˆ–é‚®ç®±">
				</div>
			</div>
			<div class="form-group">
				<div class="col-sm-10">
					<input type="password" class="form-control input-sm" id="passwd" name="passwd" placeholder="è¯·å¡«å†™å¯†ç ">
				</div>
			</div>
			<div class="form-group">
				<div class="col-sm-10">
					<div class="checkbox">
						<label>
							<input id="user_remember_me" name="remember_me" type="checkbox" value="1" checked="checked" />	è®°ä½ç™»å½•çŠ¶æ€
						</label>
						<input class="btn btn-default btn-sm" data-disable-with="æ­£åœ¨ç™»å½•" name="commit" type="submit" value="ç™»å½•" />
					</div>
					<div class="sep10"></div>
					<a href="/oauth/github/login" class="btn btn-default btn-sm">
						<i class="fa fa-github" aria-hidden="true"></i>
						GitHub ç™»å½•
					</a>
				</div>
			</div>
		</form>
	</div>
	
</div>





		
		<div class="box_white sidebar" id="ad-right1">
			
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-4512014793067058"
     data-ad-slot="4230018468"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			
		</div>
		

		<div class="box_white sidebar">
	<div class="top">
		<h3 class="title"><i class="glyphicon glyphicon-stats"></i>&nbsp;ä»Šæ—¥é˜…è¯»æ’è¡Œ</h3>
	</div>
	<div class="sb-content">
		<div class="rank-list" data-objtype="1" data-limit="10" data-rank_type="today">
			<ul class="list-unstyled">
				<img src="/static/img/loaders/loader7.gif" alt="åŠ è½½ä¸­" />
			</ul>
		</div>
	</div>
</div>
		
		
		<div class="box_white sidebar" id="ad-right2">
			
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- ä¾§è¾¹æ è‡ªé€‚åº” -->
<ins class="adsbygoogle"
     style="display:inline-block;min-width:270px;max-width:970px;width:100%;height:290px"
     data-ad-client="ca-pub-4512014793067058"
     data-ad-slot="3487838313"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
			
		</div>
		

		<div class="box_white sidebar">
	<div class="top">
		<h3 class="title"><i class="glyphicon glyphicon-stats"></i>&nbsp;ä¸€å‘¨é˜…è¯»æ’è¡Œ</h3>
	</div>
	<div class="sb-content">
		<div class="rank-list" data-objtype="1" data-limit="10" data-rank_type="week">
			<ul class="list-unstyled">
				<img src="/static/img/loaders/loader7.gif" alt="åŠ è½½ä¸­" />
			</ul>
		</div>
	</div>
</div>
		
	</div>
</div>

<link rel="stylesheet" href="https://static.studygolang.com/static/dist/css/modal.min.css?v=0.1">
<div class="modal contribute-modal animated" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close">Ã—</button>
                <h4 class="modal-title">
                    ç»™è¯¥ä¸“æ æŠ•ç¨¿
                    <a href="/articles/new" class="new-note-btn">å†™ç¯‡æ–°æ–‡ç« </a>
                </h4>
                <span class="notice">æ¯ç¯‡æ–‡ç« æœ‰æ€»å…±æœ‰ 5 æ¬¡æŠ•ç¨¿æœºä¼š</span>
                <div>
                    <input type="text" placeholder="æœç´¢æˆ‘çš„æ–‡ç« " class="search-input">
                    <a class="search-btn">
                        <i class="fa fa-search" aria-hidden="true" style="margin: 8px -1px 0 0;display: block;"></i>
                    </a>
                </div>
            </div>
            <div class="modal-body">
                <ul id="contribute-note-list"></ul>
                <div class="modal-notes-placeholder" style="display: none;">
                    <div class="text"></div>
                    <div class="btn"></div>
                </div>
            </div>
            <div class="modal-footer"></div>
        </div>
    </div>
</div>


<div class="modal animated add-self" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" data-dismiss="modal" class="close">Ã—</button>
                <h4 class="modal-title">æ”¶å…¥åˆ°æˆ‘ç®¡ç†çš„ä¸“æ 
                    <span class="new-collection-btn"><a href="/subject/new" target="_blank">æ–°å»ºä¸“æ </a></span>
                </h4>
            </div>
            <div class="modal-body">
                <div class="search">
                    <input type="search" name="search-self" placeholder="æœç´¢æˆ‘ç®¡ç†çš„ä¸“æ ">
                    <a class="search-btn">
                        <i class="fa fa-search" aria-hidden="true" style="margin: 6px 1px 0 0;display: block;"></i>
                    </a>
                </div>
                <ul id="self-note-list"></ul>
                <div class="modal-collections-placeholder" style="display: none;">
                    <div class="avatar"></div>
                    <div class="wrap">
                        <div class="btn"></div>
                        <div class="name"></div>
                        <div class="text"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer"></div>
        </div>
    </div>
</div>



<template id="content_tpl">
<div class="show-content-free">
            <p>golangä¸­defer,panic,recoveræ˜¯å¾ˆå¸¸ç”¨çš„ä¸‰ä¸ªç‰¹æ€§ï¼Œä¸‰è€…ä¸€èµ·ä½¿ç”¨å¯ä»¥å……å½“å…¶ä»–è¯­è¨€ä¸­tryâ€¦catchâ€¦çš„è§’è‰²ï¼Œè€Œdeferæœ¬èº«åˆåƒå…¶ä»–è¯­è¨€çš„ææ„å‡½æ•°</p>
<h3>defer</h3>
<h6>åœ¨å‡½æ•°è¿”å›ä¹‹å‰è°ƒç”¨ï¼Œç”¨äºèµ„æºé‡Šæ”¾ã€æ‰“å°æ—¥å¿—ã€å¼‚å¸¸æ•è·ç­‰</h6>
<pre><code class="go">f, err := os.Open(filename)
if err != nil {
    return err
}
/**
 * è¿™é‡Œdeferè¦å†™åœ¨erråˆ¤æ–­çš„åè¾¹è€Œä¸æ˜¯os.Openåè¾¹
 * å¦‚æœèµ„æºæ²¡æœ‰è·å–æˆåŠŸï¼Œå°±æ²¡æœ‰å¿…è¦å¯¹èµ„æºæ‰§è¡Œé‡Šæ”¾æ“ä½œ
 * å¦‚æœerrä¸ä¸ºnilè€Œæ‰§è¡Œèµ„æºæ‰§è¡Œé‡Šæ”¾æ“ä½œï¼Œæœ‰å¯èƒ½å¯¼è‡´panic
 */
defer f.Close()
</code></pre>
<h6>å¦‚æœæœ‰å¤šä¸ªdeferè¡¨è¾¾å¼ï¼Œè°ƒç”¨é¡ºåºç±»ä¼¼äºæ ˆï¼Œè¶Šåé¢çš„deferè¡¨è¾¾å¼è¶Šå…ˆè¢«è°ƒç”¨(åè¿›å…ˆå‡º)</h6>
<pre><code class="go">func main() {
    defer fmt.Println(1)
    defer fmt.Println(2)
    defer fmt.Println(3)
    defer fmt.Println(4)
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>4
3
2
1
</code></pre>
<h6>å¦‚æœå«æœ‰ defer è¡¨è¾¾å¼çš„å‡½æ•°æœ‰è¿”å›å€¼ï¼Œdefer è¡¨è¾¾å¼å¯èƒ½ä¼šåœ¨è®¾ç½®å‡½æ•°è¿”å›å€¼ä¹‹åï¼Œåœ¨è¿”å›åˆ°è°ƒç”¨å‡½æ•°ä¹‹å‰ä¿®æ”¹è¿”å›å€¼ï¼Œä½¿æœ€ç»ˆçš„å‡½æ•°è¿”å›å€¼ä¸ä½ æƒ³è±¡çš„ä¸ä¸€è‡´ï¼Œè¿™é‡Œå¾ˆå®¹æ˜“è¸©å‘ï¼Œæ¥å‡ ä¸ªğŸŒ°</h6>
<p>ä¾‹1</p>
<pre><code class="go">func f() (result int) {
    defer func() {
        result++
    }()
    return 0
}
</code></pre>
<p>ä¾‹2</p>
<pre><code>func f() (r int) {
    t := 5
    defer func() {
        t = t + 5
    }()
    return t
}
</code></pre>
<p>ä¾‹3</p>
<pre><code>func f() (r int) {
    defer func(r int) {
        r = r + 5
    }(r)
    return 1
}
</code></pre>
<p>è¯·å…ˆä¸è¦å‘ä¸‹çœ‹ï¼Œåœ¨å¿ƒé‡Œè·‘ä¸€éç»“æœï¼Œç„¶åå»éªŒè¯<br/>
<strong>1çš„æ­£ç¡®ç­”æ¡ˆä¸æ˜¯0ï¼Œ2çš„æ­£ç¡®ç­”æ¡ˆä¸æ˜¯10ï¼Œ3çš„æ­£ç¡®ç­”æ¡ˆä¸æ˜¯6</strong><br/>
ä¸ºä»€ä¹ˆå‘¢ï¼Œæœ€é‡è¦çš„ä¸€ç‚¹å°±æ˜¯è¦æ˜ç™½ï¼Œ<strong>return xxxè¿™ä¸€æ¡è¯­å¥å¹¶ä¸æ˜¯ä¸€æ¡åŸå­æŒ‡ä»¤</strong><br/>
å«æœ‰deferè¡¨è¾¾å¼çš„å‡½æ•°è¿”å›çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šå…ˆç»™è¿”å›å€¼èµ‹å€¼ï¼Œç„¶åè°ƒç”¨deferè¡¨è¾¾å¼ï¼Œæœ€åæ‰æ˜¯è¿”å›åˆ°è°ƒç”¨å‡½æ•°ä¸­ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„è½¬æ¢è§„åˆ™å°†return xxxæ”¹å†™æˆ</p>
<pre><code>è¿”å›å€¼ = xxx
è°ƒç”¨deferå‡½æ•°
ç©ºçš„return
</code></pre>
<p>ä¾‹1ï¼Œå®ƒå¯ä»¥æ”¹å†™æˆè¿™æ ·</p>
<pre><code class="go">func f() (result int) {
    //returnè¯­å¥ä¸æ˜¯ä¸€æ¡åŸå­è°ƒç”¨ï¼Œreturn xxxå…¶å®æ˜¯èµ‹å€¼ï¼‹retæŒ‡ä»¤
    result = 0
    //deferè¢«æ’å…¥åˆ°returnä¹‹å‰æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯èµ‹è¿”å›å€¼å’ŒretæŒ‡ä»¤ä¹‹é—´
    func() {
        result++
    }()
    return
}
</code></pre>
<p>æ‰€ä»¥è¿™ä¸ªè¿”å›å€¼æ˜¯1<br/>
ä¾‹2ï¼Œå®ƒå¯ä»¥æ”¹å†™æˆè¿™æ ·</p>
<pre><code class="go">func f() (r int) {
    t := 5
    //èµ‹å€¼æŒ‡ä»¤
    r = t
    //deferè¢«æ’å…¥åˆ°èµ‹å€¼ä¸è¿”å›ä¹‹é—´æ‰§è¡Œï¼Œè¿™ä¸ªä¾‹å­ä¸­è¿”å›å€¼ræ²¡è¢«ä¿®æ”¹è¿‡
    func() {
        t = t + 5
    }
    return
}
</code></pre>
<p>æ‰€ä»¥è¿™ä¸ªçš„ç»“æœæ˜¯5<br/>
ä¾‹3ï¼Œå®ƒå¯ä»¥æ”¹å†™æˆè¿™æ ·</p>
<pre><code class="go">func f() (r int) {
    //ç»™è¿”å›å€¼èµ‹å€¼
    r = 1
    //è¿™é‡Œæ”¹çš„ræ˜¯ä¼ å€¼ä¼ è¿›å»çš„r(funcé‡Œè¾¹çš„ræ˜¯ä½œç”¨åŸŸä¸åŒçš„é‡åå˜é‡)ï¼Œä¸ä¼šæ”¹å˜è¦è¿”å›çš„é‚£ä¸ªrå€¼
    func(r int) {
        r = r + 5
    }(r)
    return
}
</code></pre>
<p>æ‰€ä»¥è¿™ä¸ªä¾‹å­çš„ç»“æœæ˜¯1<br/>
deferè¢«æ’å…¥åˆ°äº†èµ‹å€¼ä¸retä¹‹é—´ï¼Œå› æ­¤å¯èƒ½æœ‰æœºä¼šæ”¹å˜æœ€ç»ˆçš„è¿”å›å€¼</p>
<h6>deferå‡½æ•°çš„å‚æ•°å€¼ï¼Œæ˜¯åœ¨ç”³æ˜deferæ—¶ç¡®å®šä¸‹æ¥çš„</h6>
<p>åœ¨deferå‡½æ•°ç”³æ˜æ—¶ï¼Œå¯¹å¤–éƒ¨å˜é‡çš„å¼•ç”¨æ˜¯æœ‰ä¸¤ç§æ–¹å¼ï¼šä½œä¸ºå‡½æ•°å‚æ•°å’Œä½œä¸ºé—­åŒ…å¼•ç”¨<br/>
ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œåœ¨deferç”³æ˜æ—¶å°±æŠŠå€¼ä¼ é€’ç»™deferï¼Œå¹¶å°†å€¼ç¼“å­˜èµ·æ¥ï¼Œè°ƒç”¨deferçš„æ—¶å€™ä½¿ç”¨ç¼“å­˜çš„å€¼è¿›è¡Œè®¡ç®—<br/>
ä½œä¸ºé—­åŒ…å¼•ç”¨ï¼Œåœ¨deferå‡½æ•°æ‰§è¡Œæ—¶æ ¹æ®æ•´ä¸ªä¸Šä¸‹æ–‡ç¡®å®šå½“å‰çš„å€¼<br/>
çœ‹ä¸ªğŸŒ°</p>
<pre><code class="go">func main() {
    i := 0
    defer fmt.Println(&#34;a:&#34;, i)
    //é—­åŒ…è°ƒç”¨ï¼Œå°†å¤–éƒ¨iä¼ åˆ°é—­åŒ…ä¸­è¿›è¡Œè®¡ç®—
    defer func(j int) {
        fmt.Println(&#34;b:&#34;, j)
    }(i)
    //é—­åŒ…è°ƒç”¨ï¼Œæ•è·åŒä½œç”¨åŸŸä¸‹çš„iè¿›è¡Œè®¡ç®—
    defer func() {
        fmt.Println(&#34;c:&#34;, i)
    }()
    i++
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>c: 1
b: 0
a: 0
</code></pre>
<p>è¯´æ˜åœ°å€ï¼š<a href="https://www.jianshu.com/p/63e3d57f285f" target="_blank">https://www.jianshu.com/p/63e3d57f285f</a></p>
<h3>panicå’Œrecover</h3>
<pre><code class="go">func panic(v interface{})
</code></pre>
<blockquote>
<p>ä¸­è‹±æ–‡è¯´æ˜<br/>
The panic built-in function stops normal execution of the current goroutine.When a function F calls panic, normal execution of F stops immediately.Any functions whose execution was deferred by F are run in the usual way, and then F returns to its caller. To the caller G, the invocation of F then behaves like a call to panic,terminating G&#39;s execution and running any deferred functions.This continues until all functions in the executing goroutine have stopped,in reverse order. At that point, the program is terminated and the error condition is reported,including the value of the argument to panic. This termination sequence is called panicking and can be controlled by the built-in function recover.<br/>
panicå†…ç½®å‡½æ•°åœæ­¢å½“å‰goroutineçš„æ­£å¸¸æ‰§è¡Œï¼Œå½“å‡½æ•°Fè°ƒç”¨panicæ—¶ï¼Œå‡½æ•°Fçš„æ­£å¸¸æ‰§è¡Œè¢«ç«‹å³åœæ­¢ï¼Œç„¶åè¿è¡Œæ‰€æœ‰åœ¨Få‡½æ•°ä¸­çš„deferå‡½æ•°ï¼Œç„¶åFè¿”å›åˆ°è°ƒç”¨ä»–çš„å‡½æ•°å¯¹äºè°ƒç”¨è€…Gï¼ŒFå‡½æ•°çš„è¡Œä¸ºå°±åƒpanicä¸€æ ·ï¼Œç»ˆæ­¢Gçš„æ‰§è¡Œå¹¶è¿è¡ŒGä¸­æ‰€deferå‡½æ•°ï¼Œæ­¤è¿‡ç¨‹ä¼šä¸€ç›´ç»§ç»­æ‰§è¡Œåˆ°goroutineæ‰€æœ‰çš„å‡½æ•°ã€‚panicå¯ä»¥é€šè¿‡å†…ç½®çš„recoveræ¥æ•è·ã€‚</p>
</blockquote>
<pre><code class="go">func recover() interface{}
</code></pre>
<blockquote>
<p>ä¸­è‹±æ–‡è¯´æ˜<br/>
The recover built-in function allows a program to manage behavior of a panicking goroutine. Executing a call to recover inside a deferred function (but not any function called by it) stops the panicking sequence by restoring normal execution and retrieves the error value passed to the call of panic. If recover is called outside the deferred function it will not stop a panicking sequence. In this case, or when the goroutine is not panicking, or if the argument supplied to panic was nil, recover returns nil. Thus the return value from recover reports whether the goroutine is panicking.<br/>
recoverå†…ç½®å‡½æ•°ç”¨æ¥ç®¡ç†å«æœ‰panicè¡Œä¸ºçš„goroutineï¼Œrecoverè¿è¡Œåœ¨deferå‡½æ•°ä¸­ï¼Œè·å–panicæŠ›å‡ºçš„é”™è¯¯å€¼ï¼Œå¹¶å°†ç¨‹åºæ¢å¤æˆæ­£å¸¸æ‰§è¡Œçš„çŠ¶æ€ã€‚å¦‚æœåœ¨deferå‡½æ•°ä¹‹å¤–è°ƒç”¨recoverï¼Œé‚£ä¹ˆrecoverä¸ä¼šåœæ­¢å¹¶ä¸”æ•è·panicé”™è¯¯å¦‚æœgoroutineä¸­æ²¡æœ‰panicæˆ–è€…æ•è·çš„panicçš„å€¼ä¸ºnilï¼Œrecoverçš„è¿”å›å€¼ä¹Ÿæ˜¯nilã€‚ç”±æ­¤å¯è§ï¼Œrecoverçš„è¿”å›å€¼è¡¨ç¤ºå½“å‰goroutineæ˜¯å¦æœ‰panicè¡Œä¸º</p>
</blockquote>
<p>è¿™é‡Œæœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜ï¼Œé€šè¿‡ğŸŒ°è¡¨ç°</p>
<h6>defer è¡¨è¾¾å¼çš„å‡½æ•°å¦‚æœå®šä¹‰åœ¨ panic åé¢ï¼Œè¯¥å‡½æ•°åœ¨ panic åå°±æ— æ³•è¢«æ‰§è¡Œåˆ°</h6>
<p>åœ¨deferå‰panic</p>
<pre><code class="go">func main() {
    panic(&#34;a&#34;)
    defer func() {
        fmt.Println(&#34;b&#34;)
    }()
}
</code></pre>
<p>bæ²¡æœ‰è¢«æ‰“å°å‡ºæ¥ï¼Œç»“æœï¼š</p>
<pre><code>panic: a

goroutine 1 [running]:
main.main()
    /xxxxx/src/xxx.go:50 +0x39
exit status 2
</code></pre>
<p>åœ¨deferåpanic</p>
<pre><code class="go">func main() {
    defer func() {
        fmt.Println(&#34;b&#34;)
    }()
    panic(&#34;a&#34;)
}
</code></pre>
<p>bè¢«æ­£å¸¸æ‰“å°ï¼Œç»“æœï¼š</p>
<pre><code>b
panic: a

goroutine 1 [running]:
main.main()
    /xxxxx/src/xxx.go:50 +0x39
exit status 2
</code></pre>
<h6>Fä¸­å‡ºç°panicæ—¶ï¼ŒFå‡½æ•°ä¼šç«‹åˆ»ç»ˆæ­¢ï¼Œä¸ä¼šæ‰§è¡ŒFå‡½æ•°ä¸­åé¢çš„å†…å®¹ï¼Œä½†ä¸ä¼šç«‹åˆ»è¿”å›ï¼Œè€Œè°ƒç”¨Fçš„deferï¼Œå¦‚æœFçš„deferä¸­æœ‰recoveræ•è·ï¼Œåˆ™Fåœ¨æ‰§è¡Œå®Œdeferåæ­£å¸¸è¿”å›ï¼Œè°ƒç”¨å‡½æ•°Fçš„å‡½æ•°Gç»§ç»­æ­£å¸¸æ‰§è¡Œ</h6>
<pre><code class="go">func G() {
    defer func() {
        fmt.Println(&#34;c&#34;)
    }()
    F()
    fmt.Println(&#34;ç»§ç»­æ‰§è¡Œ&#34;)
}

func F() {
    defer func() {
        if err := recover(); err != nil {
            fmt.Println(&#34;æ•è·å¼‚å¸¸:&#34;, err)
        }
        fmt.Println(&#34;b&#34;)
    }()
    panic(&#34;a&#34;)
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>æ•è·å¼‚å¸¸: a
b
ç»§ç»­æ‰§è¡Œ
c
</code></pre>
<h6>å¦‚æœFçš„deferä¸­æ— recoveræ•è·ï¼Œåˆ™å°†panicæŠ›åˆ°Gä¸­ï¼ŒGå‡½æ•°ä¼šç«‹åˆ»ç»ˆæ­¢ï¼Œä¸ä¼šæ‰§è¡ŒGå‡½æ•°ä¸­åé¢çš„å†…å®¹ï¼Œä½†ä¸ä¼šç«‹åˆ»è¿”å›ï¼Œè€Œè°ƒç”¨Gçš„defer...ä»¥æ­¤ç±»æ¨</h6>
<pre><code class="go">func G() {
    defer func() {
        if err := recover(); err != nil {
            fmt.Println(&#34;æ•è·å¼‚å¸¸:&#34;, err)
        }
        fmt.Println(&#34;c&#34;)
    }()
    F()
    fmt.Println(&#34;ç»§ç»­æ‰§è¡Œ&#34;)
}

func F() {
    defer func() {
        fmt.Println(&#34;b&#34;)
    }()
    panic(&#34;a&#34;)
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>b
æ•è·å¼‚å¸¸: a
c
</code></pre>
<h6>å¦‚æœä¸€ç›´æ²¡æœ‰recoverï¼ŒæŠ›å‡ºçš„panicåˆ°å½“å‰goroutineæœ€ä¸Šå±‚å‡½æ•°æ—¶ï¼Œç¨‹åºç›´æ¥å¼‚å¸¸ç»ˆæ­¢</h6>
<pre><code class="go">func G() {
    defer func() {
        fmt.Println(&#34;c&#34;)
    }()
    F()
    fmt.Println(&#34;ç»§ç»­æ‰§è¡Œ&#34;)
}

func F() {
    defer func() {
        fmt.Println(&#34;b&#34;)
    }()
    panic(&#34;a&#34;)
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>b
c
panic: a

goroutine 1 [running]:
main.F()
    /xxxxx/src/xxx.go:61 +0x55
main.G()
    /xxxxx/src/xxx.go:53 +0x42
exit status 2
</code></pre>
<h6>recoveréƒ½æ˜¯åœ¨<code>å½“å‰çš„goroutine</code>é‡Œè¿›è¡Œæ•è·çš„ï¼Œè¿™å°±æ˜¯è¯´ï¼Œå¯¹äºåˆ›å»ºgoroutineçš„å¤–å±‚å‡½æ•°ï¼Œå¦‚æœgoroutineå†…éƒ¨å‘ç”Ÿpanicå¹¶ä¸”å†…éƒ¨æ²¡æœ‰ç”¨recoverï¼Œå¤–å±‚å‡½æ•°æ˜¯æ— æ³•ç”¨recoveræ¥æ•è·çš„ï¼Œè¿™æ ·ä¼šé€ æˆç¨‹åºå´©æºƒ</h6>
<pre><code>func G() {
    defer func() {
        //goroutineå¤–è¿›è¡Œrecover
        if err := recover(); err != nil {
            fmt.Println(&#34;æ•è·å¼‚å¸¸:&#34;, err)
        }
        fmt.Println(&#34;c&#34;)
    }()
    //åˆ›å»ºgoroutineè°ƒç”¨Få‡½æ•°
    go F()
    time.Sleep(time.Second)
}

func F() {
    defer func() {
        fmt.Println(&#34;b&#34;)
    }()
    //goroutineå†…éƒ¨æŠ›å‡ºpanic
    panic(&#34;a&#34;)
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>b
panic: a

goroutine 5 [running]:
main.F()
    /xxxxx/src/xxx.go:67 +0x55
created by main.main
    /xxxxx/src/xxx.go:58 +0x51
exit status 2
</code></pre>
<h6>recoverè¿”å›çš„æ˜¯interface{}ç±»å‹è€Œä¸æ˜¯goä¸­çš„ error ç±»å‹ï¼Œå¦‚æœå¤–å±‚å‡½æ•°éœ€è¦è°ƒç”¨err.Error()ï¼Œä¼šç¼–è¯‘é”™è¯¯ï¼Œä¹Ÿå¯èƒ½ä¼šåœ¨æ‰§è¡Œæ—¶panic</h6>
<pre><code>func main() {
    defer func() {
        if err := recover(); err != nil {
            fmt.Println(&#34;æ•è·å¼‚å¸¸:&#34;, err.Error())
        }
    }()
    panic(&#34;a&#34;)
}
</code></pre>
<p>ç¼–è¯‘é”™è¯¯ï¼Œç»“æœï¼š</p>
<pre><code>err.Error undefined (type interface {} is interface with no methods)
</code></pre>
<pre><code>func main() {
    defer func() {
        if err := recover(); err != nil {
            fmt.Println(&#34;æ•è·å¼‚å¸¸:&#34;, fmt.Errorf(&#34;%v&#34;, err).Error())
        }
    }()
    panic(&#34;a&#34;)
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>æ•è·å¼‚å¸¸: a
</code></pre>
<p>å‚è€ƒï¼š<br/>
https: //golang.org/pkg/builtin/#recover<br/>
https: <a href="//www.w3cschool.cn/go_internals/go_internals-drq7282o.html" target="_blank" rel="nofollow">//www.w3cschool.cn/go_internals/go_internals-drq7282o.html</a></p>

          </div>
</template>



		</div>
	</div>
	<div class="sep10"></div>
	<footer id="bottom">
		<div class="container nav-content">
			<div class="inner_content">
				<div class="sep10"></div>   
				<strong>
					
					<a href="/wiki/about" class="dark">å…³äº</a> &nbsp; <span class="snow">â€¢</span> &nbsp; 
					
					<a href="/wiki/faq" class="dark">FAQ</a> &nbsp; <span class="snow">â€¢</span> &nbsp; 
					
					<a href="/wiki/contributors" class="dark">è´¡çŒ®è€…</a> &nbsp; <span class="snow">â€¢</span> &nbsp; 
					
					<a href="/go/feedback" class="dark">åé¦ˆ</a> &nbsp; <span class="snow">â€¢</span> &nbsp; 
					
					<a href="https://github.com/studygolang" class="dark">Github</a> &nbsp; <span class="snow">â€¢</span> &nbsp; 
					
					<a href="http://weibo.com/studygolang" class="dark">æ–°æµªå¾®åš</a> &nbsp; <span class="snow">â€¢</span> &nbsp; 
					
					<a href="https://play.studygolang.com" class="dark">Play</a> &nbsp; <span class="snow">â€¢</span> &nbsp; 
					
					<a href="/wiki/duty" class="dark">å…è´£å£°æ˜</a> &nbsp; <span class="snow">â€¢</span> &nbsp; 
					
					<a href="/wiki/contact" class="dark">è”ç³»æˆ‘ä»¬</a> &nbsp; <span class="snow">â€¢</span> &nbsp; 
					
					<a href="/wiki/donate" class="dark">æèµ </a> &nbsp; <span class="snow">â€¢</span> &nbsp; 
					
					<a href="/wiki/cool" class="dark">é…·ç«™</a> &nbsp; <span class="snow">â€¢</span> &nbsp; 
					
					<a href="/feed.html" class="dark">Feedè®¢é˜…</a> &nbsp; <span class="snow">â€¢</span> &nbsp; 
					
					<span id="onlineusers">1502</span> äººåœ¨çº¿
				</strong>
				&nbsp;<span class="cc">æœ€é«˜è®°å½• <span id="maxonline">2928</span></span>
				<div class="sep20"></div>
				&copy;2013-2018 studygolang.com Goè¯­è¨€ä¸­æ–‡ç½‘ï¼Œä¸­å›½ Golang ç¤¾åŒºï¼Œè‡´åŠ›äºæ„å»ºå®Œå–„çš„ Golang ä¸­æ–‡ç¤¾åŒºï¼ŒGoè¯­è¨€çˆ±å¥½è€…çš„å­¦ä¹ å®¶å›­ã€‚
				<div class="sep5"></div>
				Powered by <a href="https://github.com/studygolang/studygolang">StudyGolang(Golang + MySQL)</a> &nbsp;<span class="snow">â€¢</span>&nbsp;<span class="snow">Â·</span>&nbsp;CDN é‡‡ç”¨ <a href="https://portal.qiniu.com/signup?code=3lfz4at7pxfma" title="ä¸ƒç‰›äº‘" class="dark" target="_blank">ä¸ƒç‰›äº‘</a>
				<div class="sep20"></div>
				<span class="small cc">VERSION: V3.5.0&nbsp;<span class="snow">Â·</span>&nbsp;46.066802ms&nbsp;<span class="snow">Â·</span>&nbsp;<strong>ä¸ºäº†æ›´å¥½çš„ä½“éªŒï¼Œæœ¬ç«™æ¨èä½¿ç”¨ Chrome æˆ– Firefox æµè§ˆå™¨</strong></span>
				<div class="sep20"></div>
				<span class="f12 c9"><a href="http://www.miibeian.gov.cn/" target="_blank" rel="nofollow">äº¬ICPå¤‡14030343å·-1</a></span>
				<div class="sep10"></div>
			</div>
		</div>
	</footer>

	<div id="gotop"></div>

	
	<input type="hidden" id="is_login_status" value="0" />
	<div class="pop login-pop" id="login-pop">
		<div style="position: relative;"><span class="close" style="position: absolute; right: -15px; top: -15px; cursor: pointer; color: #000; font-size: 13px;">X</span></div>
		<div class="login-form">
			<div class="error text-center"></div>
			<div class="text-center" style="margin-bottom: 5px;">ç™»å½•å’Œå¤§å®¶ä¸€èµ·æ¢è®¨å§</div>
			<form action="#" method="post" class="form-horizontal" role="form">
				<div class="form-group">
					<label for="username" class="col-sm-3 control-label">ç”¨æˆ·å</label>
					<div class="col-sm-9 form-input">
						<input type="text" class="form-control" id="form_username" name="username" placeholder="è¯·å¡«å†™ç”¨æˆ·åæˆ–é‚®ç®±">
					</div>
				</div>
				<div class="form-group">
					<label for="passwd" class="col-sm-3 control-label">å¯†ç </label>
					<div class="col-sm-9 form-input">
						<input type="password" class="form-control" id="form_passwd" name="passwd" placeholder="å¯†ç ">
					</div>
				</div>
				<div class="form-group">
					<div class="col-sm-offset-2 col-sm-10">
						<div class="checkbox">
							<label>
								<input id="user_remember_me" name="remember_me" type="checkbox" value="1" checked="checked" />	è®°ä½ç™»å½•çŠ¶æ€
							</label>
							<button type="submit" id="login-btn" class="btn btn-default btn-sm">ç™»å½•</button>
						</div>
					</div>
				</div>
				<div class="form-group">
					<div class="col-sm-offset-2 col-sm-10">
						<a id="login-github" href="/oauth/github/login" class="btn btn-default btn-sm pull-left">
							<i class="fa fa-github" aria-hidden="true"></i>
							GitHub ç™»å½•
						</a>
						<div class="forget">
							<a href="/account/forgetpwd" title="ç‚¹å‡»æ‰¾å›å¯†ç ">å¿˜è®°å¯†ç ï¼Ÿ</a>
						</div>
						<div class="register">
							<span>è¿˜ä¸æ˜¯ä¼šå‘˜</span><a href="/account/register">ç°åœ¨æ³¨å†Œ</a>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>
	<div id="sg-overlay"></div>
	
	
	<script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="https://cdn.staticfile.org/jquery-timeago/1.6.1/jquery.timeago.min.js"></script>
	<script src="https://cdn.staticfile.org/zoom.js/0.0.1/zoom.min.js"></script>
	<script src="https://cdn.staticfile.org/marked/0.3.6/marked.min.js"></script>
	<script src="https://cdn.staticfile.org/Caret.js/0.3.1/jquery.caret.min.js"></script>
	<script src="https://cdn.staticfile.org/emojify.js/1.1.0/js/emojify.min.js"></script>

	<script type="text/javascript">
	var uid =  0 ;
	var isHttps =  true ,
		cdnDomain = "https:\/\/static.studygolang.com\/";
	if (isHttps) {
		var wsUrl = 'wss://studygolang.com/ws?uid='+uid;
	} else {
		var wsUrl = 'ws://studygolang.com/ws?uid='+uid;
	}
	var GLaunchTime =  1540036286 *1000;
	</script>
	<script src="https://cdn.staticfile.org/lscache/1.1.0/lscache.min.js"></script>
	<script src="https://cdn.staticfile.org/jsrender/0.9.90/jsrender.min.js"></script>
	<script src="https://cdn.staticfile.org/plupload/3.1.1/plupload.full.min.js"></script>
	<script type="text/javascript">
	$.views.settings.delimiters("[%", "%]");
	
	</script>

	<script src="https://static.studygolang.com/static/dist/js/sg_libs.min.js"></script>
	<script src="https://static.studygolang.com/static/dist/js/sg_base.min.js?v=0.4"></script>

	

<script type="text/javascript" src="https://static.studygolang.com/static/dist/js/articles.min.js"></script>

<script type="text/javascript">

SG.SIDE_BARS = [
	"/rank/view",
];

var keyprefix = 'article';
var objid =  15776 ;

$(function(){
	
	
	
	$('.need-autogrow').autoGrow();
	
	loadComments();

	
	$('#wrapper .content').on('mousedown', 'a', function(evt){
		var url = $(this).attr('href');
		
		$(this).attr('href', url);
		$(this).attr('target', '_blank');
	});

	var len = 'golangä¸­defer,panic,recoveræ˜¯å¾ˆå¸¸ç”¨çš„ä¸‰ä¸ªç‰¹æ€§ï¼Œä¸‰è€…ä¸€èµ·ä½¿ç”¨å¯ä»¥å……å½“å…¶ä»–è¯­è¨€ä¸­tryâ€¦catchâ€¦çš„è§’è‰²ï¼Œè€Œdeferæœ¬èº«åˆåƒå…¶ä»–è¯­è¨€çš„ææ„å‡½æ•° defer åœ¨å‡½æ•°è¿”å›ä¹‹å‰è°ƒç”¨ï¼Œç”¨äºèµ„æºé‡Šæ”¾ã€æ‰“å°æ—¥å¿—ã€å¼‚å¸¸æ•è·ç­‰ f, err := os.Open(filename) if err != nil { return err } \/** * è¿™é‡Œdeferè¦å†™åœ¨erråˆ¤æ–­çš„åè¾¹è€Œä¸æ˜¯os.Openåè¾¹ * å¦‚æœèµ„æºæ²¡æœ‰è·å–æˆåŠŸï¼Œå°±æ²¡æœ‰å¿…è¦å¯¹èµ„æºæ‰§è¡Œé‡Šæ”¾æ“ä½œ * å¦‚æœerrä¸ä¸ºnilè€Œæ‰§è¡Œèµ„æºæ‰§è¡Œé‡Šæ”¾æ“ä½œï¼Œæœ‰å¯èƒ½å¯¼è‡´panic *\/ defer f.Close() å¦‚æœæœ‰å¤šä¸ªdeferè¡¨è¾¾å¼ï¼Œè°ƒç”¨é¡ºåºç±»ä¼¼äºæ ˆï¼Œè¶Šåé¢çš„deferè¡¨è¾¾å¼è¶Šå…ˆè¢«è°ƒç”¨(åè¿›å…ˆå‡º) func main() { defer fmt.Println(1) defer fmt.Println(2) defer fmt.Println(3) defer fmt.Println(4) } ç»“æœï¼š 4 3 2 1 å¦‚æœå«æœ‰ defer è¡¨è¾¾å¼çš„å‡½æ•°æœ‰è¿”å›å€¼ï¼Œdefer è¡¨è¾¾å¼å¯èƒ½ä¼šåœ¨è®¾ç½®å‡½æ•°è¿”å›å€¼ä¹‹åï¼Œåœ¨è¿”å›åˆ°è°ƒç”¨å‡½æ•°ä¹‹å‰ä¿®æ”¹è¿”å›å€¼ï¼Œä½¿æœ€ç»ˆçš„å‡½æ•°è¿”å›å€¼ä¸ä½ æƒ³è±¡çš„ä¸ä¸€è‡´ï¼Œè¿™é‡Œå¾ˆå®¹æ˜“è¸©å‘ï¼Œæ¥å‡ ä¸ªğŸŒ° ä¾‹1 func f() (result int) { defer func() { result\x2b\x2b }() return 0 } ä¾‹2 func f() (r int) { t := 5 defer func() { t = t \x2b 5 }() return t } ä¾‹3 func f() (r int) { defer func(r int) { r = r \x2b 5 }(r) return 1 } è¯·å…ˆä¸è¦å‘ä¸‹çœ‹ï¼Œåœ¨å¿ƒé‡Œè·‘ä¸€éç»“æœï¼Œç„¶åå»éªŒè¯ 1çš„æ­£ç¡®ç­”æ¡ˆä¸æ˜¯0ï¼Œ2çš„æ­£ç¡®ç­”æ¡ˆä¸æ˜¯10ï¼Œ3çš„æ­£ç¡®ç­”æ¡ˆä¸æ˜¯6 ä¸ºä»€ä¹ˆå‘¢ï¼Œæœ€é‡è¦çš„ä¸€ç‚¹å°±æ˜¯è¦æ˜ç™½ï¼Œreturn xxxè¿™ä¸€æ¡è¯­å¥å¹¶ä¸æ˜¯ä¸€æ¡åŸå­æŒ‡ä»¤ å«æœ‰deferè¡¨è¾¾å¼çš„å‡½æ•°è¿”å›çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šå…ˆç»™è¿”å›å€¼èµ‹å€¼ï¼Œç„¶åè°ƒç”¨deferè¡¨è¾¾å¼ï¼Œæœ€åæ‰æ˜¯è¿”å›åˆ°è°ƒç”¨å‡½æ•°ä¸­ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„è½¬æ¢è§„åˆ™å°†return xxxæ”¹å†™æˆ è¿”å›å€¼ = xxx è°ƒç”¨deferå‡½æ•° ç©ºçš„return ä¾‹1ï¼Œå®ƒå¯ä»¥æ”¹å†™æˆè¿™æ · func f() (result int) { \/\/returnè¯­å¥ä¸æ˜¯ä¸€æ¡åŸå­è°ƒç”¨ï¼Œreturn xxxå…¶å®æ˜¯èµ‹å€¼ï¼‹retæŒ‡ä»¤ result = 0 \/\/deferè¢«æ’å…¥åˆ°returnä¹‹å‰æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯èµ‹è¿”å›å€¼å’ŒretæŒ‡ä»¤ä¹‹é—´ func() { result\x2b\x2b }() return } æ‰€ä»¥è¿™ä¸ªè¿”å›å€¼æ˜¯1 ä¾‹2ï¼Œå®ƒå¯ä»¥æ”¹å†™æˆè¿™æ · func f() (r int) { t := 5 \/\/èµ‹å€¼æŒ‡ä»¤ r = t \/\/deferè¢«æ’å…¥åˆ°èµ‹å€¼ä¸è¿”å›ä¹‹é—´æ‰§è¡Œï¼Œè¿™ä¸ªä¾‹å­ä¸­è¿”å›å€¼ræ²¡è¢«ä¿®æ”¹è¿‡ func() { t = t \x2b 5 } return } æ‰€ä»¥è¿™ä¸ªçš„ç»“æœæ˜¯5 ä¾‹3ï¼Œå®ƒå¯ä»¥æ”¹å†™æˆè¿™æ · func f() (r int) { \/\/ç»™è¿”å›å€¼èµ‹å€¼ r = 1 \/\/è¿™é‡Œæ”¹çš„ræ˜¯ä¼ å€¼ä¼ è¿›å»çš„r(funcé‡Œè¾¹çš„ræ˜¯ä½œç”¨åŸŸä¸åŒçš„é‡åå˜é‡)ï¼Œä¸ä¼šæ”¹å˜è¦è¿”å›çš„é‚£ä¸ªrå€¼ func(r int) { r = r \x2b 5 }(r) return } æ‰€ä»¥è¿™ä¸ªä¾‹å­çš„ç»“æœæ˜¯1 deferè¢«æ’å…¥åˆ°äº†èµ‹å€¼ä¸retä¹‹é—´ï¼Œå› æ­¤å¯èƒ½æœ‰æœºä¼šæ”¹å˜æœ€ç»ˆçš„è¿”å›å€¼ deferå‡½æ•°çš„å‚æ•°å€¼ï¼Œæ˜¯åœ¨ç”³æ˜deferæ—¶ç¡®å®šä¸‹æ¥çš„ åœ¨deferå‡½æ•°ç”³æ˜æ—¶ï¼Œå¯¹å¤–éƒ¨å˜é‡çš„å¼•ç”¨æ˜¯æœ‰ä¸¤ç§æ–¹å¼ï¼šä½œä¸ºå‡½æ•°å‚æ•°å’Œä½œä¸ºé—­åŒ…å¼•ç”¨ ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œåœ¨deferç”³æ˜æ—¶å°±æŠŠå€¼ä¼ é€’ç»™deferï¼Œå¹¶å°†å€¼ç¼“å­˜èµ·æ¥ï¼Œè°ƒç”¨deferçš„æ—¶å€™ä½¿ç”¨ç¼“å­˜çš„å€¼è¿›è¡Œè®¡ç®— ä½œä¸ºé—­åŒ…å¼•ç”¨ï¼Œåœ¨deferå‡½æ•°æ‰§è¡Œæ—¶æ ¹æ®æ•´ä¸ªä¸Šä¸‹æ–‡ç¡®å®šå½“å‰çš„å€¼ çœ‹ä¸ªğŸŒ° func main() { i := 0 defer fmt.Println(\x22a:\x22, i) \/\/é—­åŒ…è°ƒç”¨ï¼Œå°†å¤–éƒ¨iä¼ åˆ°é—­åŒ…ä¸­è¿›è¡Œè®¡ç®— defer func(j int) { fmt.Println(\x22b:\x22, j) }(i) \/\/é—­åŒ…è°ƒç”¨ï¼Œæ•è·åŒä½œç”¨åŸŸä¸‹çš„iè¿›è¡Œè®¡ç®— defer func() { fmt.Println(\x22c:\x22, i) }() i\x2b\x2b } ç»“æœï¼š c: 1 b: 0 a: 0 è¯´æ˜åœ°å€ï¼šhttps:\/\/www.jianshu.com\/p\/63e3d57f285f panicå’Œrecover func panic(v interface{}) ä¸­è‹±æ–‡è¯´æ˜ The panic built-in function stops normal execution of the current goroutine.When a function F calls panic, normal execution of F stops immediately.Any functions whose execution was deferred by F are run in the usual way, and then F returns to its caller. To the caller G, the invocation of F then behaves like a call to panic,terminating G\x27s execution and running any deferred functions.This continues until all functions in the executing goroutine have stopped,in reverse order. At that point, the program is terminated and the error condition is reported,including the value of the argument to panic. This termination sequence is called panicking and can be controlled by the built-in function recover. panicå†…ç½®å‡½æ•°åœæ­¢å½“å‰goroutineçš„æ­£å¸¸æ‰§è¡Œï¼Œå½“å‡½æ•°Fè°ƒç”¨panicæ—¶ï¼Œå‡½æ•°Fçš„æ­£å¸¸æ‰§è¡Œè¢«ç«‹å³åœæ­¢ï¼Œç„¶åè¿è¡Œæ‰€æœ‰åœ¨Få‡½æ•°ä¸­çš„deferå‡½æ•°ï¼Œç„¶åFè¿”å›åˆ°è°ƒç”¨ä»–çš„å‡½æ•°å¯¹äºè°ƒç”¨è€…Gï¼ŒFå‡½æ•°çš„è¡Œä¸ºå°±åƒpanicä¸€æ ·ï¼Œç»ˆæ­¢Gçš„æ‰§è¡Œå¹¶è¿è¡ŒGä¸­æ‰€deferå‡½æ•°ï¼Œæ­¤è¿‡ç¨‹ä¼šä¸€ç›´ç»§ç»­æ‰§è¡Œåˆ°goroutineæ‰€æœ‰çš„å‡½æ•°ã€‚panicå¯ä»¥é€šè¿‡å†…ç½®çš„recoveræ¥æ•è·ã€‚ func recover() interface{} ä¸­è‹±æ–‡è¯´æ˜ The recover built-in function allows a program to manage behavior of a panicking goroutine. Executing a call to recover inside a deferred function (but not any function called by it) stops the panicking sequence by restoring normal execution and retrieves the error value passed to the call of panic. If recover is called outside the deferred function it will not stop a panicking sequence. In this case, or when the goroutine is not panicking, or if the argument supplied to panic was nil, recover returns nil. Thus the return value from recover reports whether the goroutine is panicking. recoverå†…ç½®å‡½æ•°ç”¨æ¥ç®¡ç†å«æœ‰panicè¡Œä¸ºçš„goroutineï¼Œrecoverè¿è¡Œåœ¨deferå‡½æ•°ä¸­ï¼Œè·å–panicæŠ›å‡ºçš„é”™è¯¯å€¼ï¼Œå¹¶å°†ç¨‹åºæ¢å¤æˆæ­£å¸¸æ‰§è¡Œçš„çŠ¶æ€ã€‚å¦‚æœåœ¨deferå‡½æ•°ä¹‹å¤–è°ƒç”¨recoverï¼Œé‚£ä¹ˆrecoverä¸ä¼šåœæ­¢å¹¶ä¸”æ•è·panicé”™è¯¯å¦‚æœgoroutineä¸­æ²¡æœ‰panicæˆ–è€…æ•è·çš„panicçš„å€¼ä¸ºnilï¼Œrecoverçš„è¿”å›å€¼ä¹Ÿæ˜¯nilã€‚ç”±æ­¤å¯è§ï¼Œrecoverçš„è¿”å›å€¼è¡¨ç¤ºå½“å‰goroutineæ˜¯å¦æœ‰panicè¡Œä¸º è¿™é‡Œæœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜ï¼Œé€šè¿‡ğŸŒ°è¡¨ç° defer è¡¨è¾¾å¼çš„å‡½æ•°å¦‚æœå®šä¹‰åœ¨ panic åé¢ï¼Œè¯¥å‡½æ•°åœ¨ panic åå°±æ— æ³•è¢«æ‰§è¡Œåˆ° åœ¨deferå‰panic func main() { panic(\x22a\x22) defer func() { fmt.Println(\x22b\x22) }() } bæ²¡æœ‰è¢«æ‰“å°å‡ºæ¥ï¼Œç»“æœï¼š panic: a goroutine 1 [running]: main.main() \/xxxxx\/src\/xxx.go:50 \x2b0x39 exit status 2 åœ¨deferåpanic func main() { defer func() { fmt.Println(\x22b\x22) }() panic(\x22a\x22) } bè¢«æ­£å¸¸æ‰“å°ï¼Œç»“æœï¼š b panic: a goroutine 1 [running]: main.main() \/xxxxx\/src\/xxx.go:50 \x2b0x39 exit status 2 Fä¸­å‡ºç°panicæ—¶ï¼ŒFå‡½æ•°ä¼šç«‹åˆ»ç»ˆæ­¢ï¼Œä¸ä¼šæ‰§è¡ŒFå‡½æ•°ä¸­åé¢çš„å†…å®¹ï¼Œä½†ä¸ä¼šç«‹åˆ»è¿”å›ï¼Œè€Œè°ƒç”¨Fçš„deferï¼Œå¦‚æœFçš„deferä¸­æœ‰recoveræ•è·ï¼Œåˆ™Fåœ¨æ‰§è¡Œå®Œdeferåæ­£å¸¸è¿”å›ï¼Œè°ƒç”¨å‡½æ•°Fçš„å‡½æ•°Gç»§ç»­æ­£å¸¸æ‰§è¡Œ func G() { defer func() { fmt.Println(\x22c\x22) }() F() fmt.Println(\x22ç»§ç»­æ‰§è¡Œ\x22) } func F() { defer func() { if err := recover(); err != nil { fmt.Println(\x22æ•è·å¼‚å¸¸:\x22, err) } fmt.Println(\x22b\x22) }() panic(\x22a\x22) } ç»“æœï¼š æ•è·å¼‚å¸¸: a b ç»§ç»­æ‰§è¡Œ c å¦‚æœFçš„deferä¸­æ— recoveræ•è·ï¼Œåˆ™å°†panicæŠ›åˆ°Gä¸­ï¼ŒGå‡½æ•°ä¼šç«‹åˆ»ç»ˆæ­¢ï¼Œä¸ä¼šæ‰§è¡ŒGå‡½æ•°ä¸­åé¢çš„å†…å®¹ï¼Œä½†ä¸ä¼šç«‹åˆ»è¿”å›ï¼Œè€Œè°ƒç”¨Gçš„defer...ä»¥æ­¤ç±»æ¨ func G() { defer func() { if err := recover(); err != nil { fmt.Println(\x22æ•è·å¼‚å¸¸:\x22, err) } fmt.Println(\x22c\x22) }() F() fmt.Println(\x22ç»§ç»­æ‰§è¡Œ\x22) } func F() { defer func() { fmt.Println(\x22b\x22) }() panic(\x22a\x22) } ç»“æœï¼š b æ•è·å¼‚å¸¸: a c å¦‚æœä¸€ç›´æ²¡æœ‰recoverï¼ŒæŠ›å‡ºçš„panicåˆ°å½“å‰goroutineæœ€ä¸Šå±‚å‡½æ•°æ—¶ï¼Œç¨‹åºç›´æ¥å¼‚å¸¸ç»ˆæ­¢ func G() { defer func() { fmt.Println(\x22c\x22) }() F() fmt.Println(\x22ç»§ç»­æ‰§è¡Œ\x22) } func F() { defer func() { fmt.Println(\x22b\x22) }() panic(\x22a\x22) } ç»“æœï¼š b c panic: a goroutine 1 [running]: main.F() \/xxxxx\/src\/xxx.go:61 \x2b0x55 main.G() \/xxxxx\/src\/xxx.go:53 \x2b0x42 exit status 2 recoveréƒ½æ˜¯åœ¨å½“å‰çš„goroutineé‡Œè¿›è¡Œæ•è·çš„ï¼Œè¿™å°±æ˜¯è¯´ï¼Œå¯¹äºåˆ›å»ºgoroutineçš„å¤–å±‚å‡½æ•°ï¼Œå¦‚æœgoroutineå†…éƒ¨å‘ç”Ÿpanicå¹¶ä¸”å†…éƒ¨æ²¡æœ‰ç”¨recoverï¼Œå¤–å±‚å‡½æ•°æ˜¯æ— æ³•ç”¨recoveræ¥æ•è·çš„ï¼Œè¿™æ ·ä¼šé€ æˆç¨‹åºå´©æºƒ func G() { defer func() { \/\/goroutineå¤–è¿›è¡Œrecover if err := recover(); err != nil { fmt.Println(\x22æ•è·å¼‚å¸¸:\x22, err) } fmt.Println(\x22c\x22) }() \/\/åˆ›å»ºgoroutineè°ƒç”¨Få‡½æ•° go F() time.Sleep(time.Second) } func F() { defer func() { fmt.Println(\x22b\x22) }() \/\/goroutineå†…éƒ¨æŠ›å‡ºpanic panic(\x22a\x22) } ç»“æœï¼š b panic: a goroutine 5 [running]: main.F() \/xxxxx\/src\/xxx.go:67 \x2b0x55 created by main.main \/xxxxx\/src\/xxx.go:58 \x2b0x51 exit status 2 recoverè¿”å›çš„æ˜¯interface{}ç±»å‹è€Œä¸æ˜¯goä¸­çš„ error ç±»å‹ï¼Œå¦‚æœå¤–å±‚å‡½æ•°éœ€è¦è°ƒç”¨err.Error()ï¼Œä¼šç¼–è¯‘é”™è¯¯ï¼Œä¹Ÿå¯èƒ½ä¼šåœ¨æ‰§è¡Œæ—¶panic func main() { defer func() { if err := recover(); err != nil { fmt.Println(\x22æ•è·å¼‚å¸¸:\x22, err.Error()) } }() panic(\x22a\x22) } ç¼–è¯‘é”™è¯¯ï¼Œç»“æœï¼š err.Error undefined (type interface {} is interface with no methods) func main() { defer func() { if err := recover(); err != nil { fmt.Println(\x22æ•è·å¼‚å¸¸:\x22, fmt.Errorf(\x22%v\x22, err).Error()) } }() panic(\x22a\x22) } ç»“æœï¼š æ•è·å¼‚å¸¸: a å‚è€ƒï¼š https: \/\/golang.org\/pkg\/builtin\/#recover https: \/\/www.w3cschool.cn\/go_internals\/go_internals-drq7282o.html'.length;
	var readTime = Math.round(len / 900);
	if (readTime >= 1) {
		$('.read-time').text('é¢„è®¡é˜…è¯»æ—¶é—´ '+readTime+' åˆ†é’Ÿ');
	} else {
		$('.read-time').text('é¢„è®¡é˜…è¯»æ—¶é—´ä¸åˆ° 1 åˆ†é’Ÿ');
	}
});
</script>
<script type="text/javascript" src="https://cdn.staticfile.org/ckeditor/4.6.2/ckeditor.js"></script>
<script type="text/javascript" src="https://static.studygolang.com/static/ckeditor/config.js"></script>
<script type="text/javascript" src="https://static.studygolang.com/static/ckeditor/article.js"></script>


<script type="text/javascript">
$(function(){
	$('code[class*="language-"]').parent('pre').addClass('line-numbers');
});
</script>
<script src="https://cdn.staticfile.org/prism/9000.0.1/prism.min.js"></script>
<script src="https://cdn.staticfile.org/prism/9000.0.1/components/prism-go.min.js"></script>
<script src="https://cdn.staticfile.org/prism/1.9.0/components/prism-json.min.js"></script>
<script src="https://cdn.staticfile.org/prism/9000.0.1/components/prism-bash.min.js"></script>
<script src="https://cdn.staticfile.org/prism/9000.0.1/components/prism-python.min.js"></script>
<script src="https://cdn.staticfile.org/prism/9000.0.1/components/prism-nasm.min.js"></script>
<script src="https://cdn.staticfile.org/prism/9000.0.1/components/prism-yaml.min.js"></script>
<script src="https://cdn.staticfile.org/prism/9000.0.1/plugins/line-numbers/prism-line-numbers.min.js"></script>

<script type="text/javascript">
Prism.languages.xml = Prism.languages.markup;
Prism.languages.html = Prism.languages.markup;
Prism.languages.mathml = Prism.languages.markup;
Prism.languages.svg = Prism.languages.markup;
Prism.languages.text = Prism.languages.go;
Prism.languages.golang = Prism.languages.go;
Prism.languages.none = Prism.languages.go;
Prism.languages.console = Prism.languages.bash;
Prism.languages.shell = Prism.languages.bash;
Prism.languages.asm = Prism.languages.nasm;
Prism.languages.makefile = Prism.languages.bash;
Prism.languages.Dockerfile = Prism.languages.bash;
Prism.languages.protobuf = Prism.languages.clike;
Prism.languages.c = Prism.languages.clike;
</script>



	



	




	<script type="text/javascript" src="https://static.studygolang.com/static/dist/js/sidebar.min.js?v=0.2"></script>

	
		
		

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-4512014793067058",
    enable_page_level_ads: true
  });
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-18275235-2', 'auto');
  ga('send', 'pageview');

</script>


<script>
var _hmt = _hmt || [];
if (uid > 0) {
	_hmt.push(['_setUserTag', ''+uid, 1]);
}

(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?224c227cd9239761ec770bc8c1fb134c";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script>
(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  } else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();
</script>

	

</body>
</html>
